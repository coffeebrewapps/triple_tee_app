import{D as M}from"./DataForm-a47f389f.js";import{_ as z,a as U,l as j,u as L,r as g,c as n,o as N,b as v,d as P,f as T,g as l,e as $,i as A,j as K,M as H}from"./index-196d7642.js";import{u as O}from"./input-33a9bda4.js";import"./errors-74d0bde9.js";import"./validations-83886343.js";const R={class:"view-container"},q={class:"actions"},G={__name:"SystemConfigs",setup(J){const c=U(),_=j(),{flashMessage:r}=L(),s=g(),u=g({}),i=n(()=>o.value.filter(e=>e.updatable)),d=n(()=>i.value.map(e=>e.key)),C=[{tagFormat:"md",timezone:"md"},{baseCurrencyId:"lg",baseContactId:"lg"}];function m(e){return e.id}function f(e){return`${e.code} (${e.symbol})`}function p(e){return e.name}const o=n(()=>[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"text",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:f},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:m,label:f}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:m,label:p}}]),{formatDataForShow:h,formatDataForSave:k,formatErrorsForDisplay:S}=O(o.value);function w(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function F(){const e=k(Object.assign({},s.value));await c.create("system_configs",e,{path:"replace"}).then(t=>{r("Updated config successfully!"),_.updateSystemConfigs(t)}).catch(t=>{console.error(t),u.value=S(t),r("Error updating config!")})}async function D(e){const t=d.value.map(a=>h(a,e));return new Promise((a,b)=>{Promise.all(t).then(x=>{const y={};i.value.forEach((B,V)=>{const E=B.key;y[E]=x[V]}),a(y)})})}async function I(){return new Promise((e,t)=>{c.list("system_configs",{},{path:"latest"}).then(a=>{const b=a.record;e(b)}).catch(a=>{t(a)})})}return N(async()=>{await I().then(e=>{e?D(e).then(t=>{s.value=t}):s.value=w()}).catch(e=>{console.error(e),r("Error loading config!")})}),(e,t)=>(v(),P("div",R,[s.value?(v(),T(M,{key:0,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),"fields-layout":C,"data-fields":l(d),schemas:l(o),"error-messages":u.value,submittable:!1},null,8,["modelValue","data-fields","schemas","error-messages"])):$("",!0),A("div",q,[K(l(H),{class:"button",value:"Update",icon:"fa-solid fa-check",onClick:t[1]||(t[1]=a=>F())})])]))}},ee=z(G,[["__scopeId","data-v-4005d200"]]);export{ee as default};
