import{D as U}from"./DataForm-bb2544f7.js";import{_ as j,a as L,n as M,u as N,r as l,c as y,o as P,b as g,d as T,f as $,g as v,e as A,i as K,j as O,I as H}from"./index-2c32b8d5.js";import{u as R}from"./input-61224a77.js";import"./errors-53bc63a8.js";import"./validations-9a1af222.js";const Z={class:"view-container"},q={class:"actions"},G={__name:"SystemConfigs",setup(J){const n=L(),_=M(),{flashMessage:r}=N(),s=l(),c=l({}),u=y(()=>o.value.filter(e=>e.updatable)),i=y(()=>u.value.map(e=>e.key)),C=[{tagFormat:"md",timezone:"lg"},{baseCurrencyId:"lg",baseContactId:"lg"}];function d(e){return e.id}function m(e){return`${e.code} (${e.symbol})`}function f(e){return e.name}const h=Intl.supportedValuesOf("timeZone").map(e=>({value:e,label:e})),o=l([{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"select",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0,options:h},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:m},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:d,label:m}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:f},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:d,label:f}}]),{formatDataForShow:k,formatDataForSave:S,formatErrorsForDisplay:w}=R(o.value);function F(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function I(){const e=S(Object.assign({},s.value));await n.create("system_configs",e,{path:"replace"}).then(a=>{r("Updated config successfully!"),_.updateSystemConfigs(a)}).catch(a=>{console.error(a),c.value=w(a),r("Error updating config!")})}async function D(e){const a=i.value.map(t=>k(t,e));return new Promise((t,p)=>{Promise.all(a).then(B=>{const b={};u.value.forEach((x,E)=>{const z=x.key;b[z]=B[E]}),t(b)})})}async function V(){return new Promise((e,a)=>{n.list("system_configs",{},{path:"latest"}).then(t=>{const p=t.record;e(p)}).catch(t=>{a(t)})})}return P(async()=>{await V().then(e=>{e?D(e).then(a=>{s.value=a}):s.value=F()}).catch(e=>{console.error(e),r("Error loading config!")})}),(e,a)=>(g(),T("div",Z,[s.value?(g(),$(U,{key:0,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value=t),"fields-layout":C,"data-fields":v(i),schemas:o.value,"error-messages":c.value,submittable:!1},null,8,["modelValue","data-fields","schemas","error-messages"])):A("",!0),K("div",q,[O(v(H),{class:"button",value:"Update",icon:"fa-solid fa-check",onClick:a[1]||(a[1]=t=>I())})])]))}},ae=j(G,[["__scopeId","data-v-3df34b7f"]]);export{ae as default};
