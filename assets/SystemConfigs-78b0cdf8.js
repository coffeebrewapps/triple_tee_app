import{u as T,F as U}from"./Form-77967d6a.js";import{_ as j,b as L,m as N,a as P,r as v,c as n,o as $,d as _,e as A,g as K,h as l,f as H,j as O,k as R,M as q}from"./index-b3128bd9.js";import"./errors-a6177d44.js";const G={class:"view-container"},J={class:"actions"},Q={__name:"SystemConfigs",setup(W){const c=L(),C=N(),u=P(),s=v(),i=v({}),d=n(()=>r.value.filter(e=>e.updatable)),m=n(()=>d.value.map(e=>e.key)),h=[{tagFormat:"md",timezone:"md"},{baseCurrencyId:"lg",baseContactId:"lg"}];function f(e){return e.id}function b(e){return`${e.code} (${e.symbol})`}function p(e){return e.name}const r=n(()=>[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"text",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:b},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:f,label:b}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:f,label:p}}]),{formatDataForShow:k,formatDataForSave:w,formatErrorsForDisplay:S}=T(r.value);function F(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function B(){const e=w(Object.assign({},s.value));await c.create("system_configs",e,{path:"replace"}).then(a=>{o("Updated config successfully!"),C.updateSystemConfigs(a)}).catch(a=>{console.error(a),i.value=S(a),o("Error updating config!")})}async function I(e){const a=m.value.map(t=>k(t,e));return new Promise((t,y)=>{Promise.all(a).then(V=>{const g={};d.value.forEach((E,z)=>{const M=E.key;g[M]=V[z]}),t(g)})})}async function D(){return new Promise((e,a)=>{c.list("system_configs",{},{path:"latest"}).then(t=>{const y=t.record;e(y)}).catch(t=>{a(t)})})}function o(e){u.show(e),setTimeout(x,5e3)}function x(){u.hide()}return $(async()=>{await D().then(e=>{e?I(e).then(a=>{s.value=a}):s.value=F()}).catch(e=>{console.error(e),o("Error loading config!")})}),(e,a)=>(_(),A("div",G,[s.value?(_(),K(U,{key:0,modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value=t),"fields-layout":h,"data-fields":l(m),schemas:l(r),"error-messages":i.value,submittable:!1},null,8,["modelValue","data-fields","schemas","error-messages"])):H("",!0),O("div",J,[R(l(q),{class:"button",value:"Update",icon:"fa-solid fa-check",onClick:a[1]||(a[1]=t=>B())})])]))}},ee=j(Q,[["__scopeId","data-v-5d3a9afb"]]);export{ee as default};
