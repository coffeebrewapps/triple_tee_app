import{a as ye}from"./dataAccess-0d808513.js";import{c as O,y as ve,_ as fe,r as oe,o as he,a as v,b as P,h as re,F as ue,m as le,A as Oe,z as ce,e as C,f as r,W as Ve,d as U,G as Fe,E as ke,H as Te,J as je,I as ie,U as De,K as Ue,M as me,i as se,B as Ce,D as we,S as pe}from"./index-e89d949c.js";import{u as Se}from"./errors-a6177d44.js";function Ee(){function f(p){return!i(p)}function i(p){return Object.is(p,void 0)||Object.is(p,null)}function k(p,y,o){const d=p[y],M=p[o];if(!(!d||!M)&&d<M)return{name:"earlierThan",params:{compareDate:o}}}function E(p,y){const o=p[y];if(!o)return;if(o>new Date)return{name:"futureDate",params:{}}}function z(p,y){const o=p[y];if(!o)return;if(o<new Date)return{name:"futureDate",params:{}}}function V(p,y,o){const d=p[y];if(!i(d)&&!(d>o))return{name:"greaterThan",params:{compareValue:o}}}function b(p,y,o){const d=p[y];if(!i(d)&&!(d>=o))return{name:"greaterThanOrEqual",params:{compareValue:o}}}function x(p,y,o){const d=p[y];if(!i(d)&&!(d<o))return{name:"lessThan",params:{compareValue:o}}}function I(p,y,o){const d=p[y];if(!i(d)&&!(d<=o))return{name:"lessThanOrEqual",params:{compareValue:o}}}return Object.assign({},{notEmpty:f,isEmpty:i},{notEarlierThan:k,futureDate:E,pastDate:z},{greaterThan:V,greaterThanOrEqual:b,lessThan:x,lessThanOrEqual:I})}const de=ye(),{formatDate:Be,formatTimestamp:Me,formatTag:$e,tagStyle:He}=ve(),{isEmpty:be,notEmpty:w}=Ee();function Pe(f){const i=O(()=>f.reduce((t,s)=>(t[s.key]=s,t),{})),k=O(()=>Object.keys(i.value).filter(t=>F(t))),E=O(()=>Object.keys(i.value).filter(t=>J(t))),z=O(()=>Object.keys(i.value).filter(t=>L(t))),V=O(()=>Object.keys(i.value).filter(t=>m(t))),b=O(()=>Object.keys(i.value).filter(t=>B(t))),x=O(()=>Object.keys(i.value).filter(t=>$(t))),I=O(()=>Object.keys(i.value).filter(t=>H(t))),_=O(()=>Object.keys(i.value).filter(t=>N(t))),A=O(()=>Object.keys(i.value).filter(t=>K(t))),p=O(()=>f.filter(t=>t.reference)),y=O(()=>p.value.map(t=>t.key));function o(t){return(i.value[t]||{}).type}function d(t){return(i.value[t]||{}).label}function M(t,s,a,n){const u=a.find(e=>e===t),c=s[t];if(c)if(u){const e=s.includes||{},g=[c].flat().filter(h=>!!h).map(h=>{const S=e[t][h];return i.value[t].reference.label(S)});return m(t)?g:g[0]}else return o(t)==="enum"||o(t)==="select"?n.find(g=>g.key===t).options.find(g=>g.value===c).label:o(t)==="datetime"?Me(c):o(t)==="date"?Be(c):c}function Q(t){return o(t)==="text"||o(t)==="number"}function X(t){return o(t)==="textarea"}function m(t){return o(t)==="multiSelect"}function B(t){return o(t)==="singleSelect"}function F(t){return o(t)==="select"||o(t)==="enum"}function L(t){return o(t)==="select"||o(t)==="multiSelect"||o(t)==="singleSelect"||o(t)==="enum"}function J(t){return L(t)&&i.value[t].options&&i.value[t].options.server}function $(t){return i.value[t].nullToggleable}function H(t){return t==="tags"||Object.is(i.value[t].isTags,!0)}function N(t){return o(t)==="object"}function K(t){return o(t)==="number"}function R(t,s,a,n){return Object.assign({},{loading:!1,pagination:{offset:s,limit:a,client:!1}},n)}function Y(t){return f.map(s=>{if(s.type==="enum"){const a=t[s.key].enums,n=Object.keys(a).map(c=>({value:c,label:a[c]}));return Object.assign({},s,{options:n})}else return s})}function T(t,s){return Object.keys(t).reduce((a,n)=>{const c=t[n].map(e=>e(s)).filter(e=>!!e);return c.length>0&&(a[n]=c),a},{})}async function Z(t,s){return de.view(t,s,{})}async function j(t,s){const a=i.value[t].options,n=a.modelClass,u=s.map(c=>Z(n,c));return new Promise((c,e)=>{Promise.all(u).then(l=>{const g=l.map(h=>{const S=a.value(h),ae=a.label(h);return{value:S,label:ae}});c(g)}).catch(l=>{console.error(l),e(l)})})}function q(t,s){const a=s[t];if(w(a))return a;const n=i.value[t].defaultValue;return w(n)?n():a}async function D(t,s){return new Promise((a,n)=>{const u=q(t,s);if(be(u)){a(u);return}if(N(t)){w(u)?a(JSON.stringify(u,!1,4)):a(u);return}if(o(t)!=="date"&&o(t)!=="datetime"&&!m(t)&&!B(t)){a(u);return}if(o(t)==="date"||o(t)==="datetime"){let e;u instanceof Date?e=new Date(u):e=Object.entries(u).reduce((l,[g,h])=>(w(h)?l[g]=new Date(h):l[g]=h,l),{}),a(e);return}const c=[u].flat();if(w(s.includes)&&w(s.includes[t])&&Object.keys(s.includes[t]).length>0){const e=s.includes[t],l=c.map(g=>{const h=e[g],S=i.value[t].options,ae=S.value(h),ge=S.label(h);return{value:ae,label:ge}});a(l)}else i.value[t].options,j(t,c).then(e=>{a(e)}).catch(e=>{const l=[];c.forEach(g=>{w(g)&&l.push({value:g,label:g})}),a(l)})})}function ee(t){const s=Object.assign({},t);return V.value.forEach(a=>{const n=s[a]||[];s[a]=n.map(u=>u.value)}),b.value.forEach(a=>{const n=s[a]||[];s[a]=(n[0]||{}).value}),k.value.forEach(a=>{const n=s[a];(be(n)||n.length===0)&&delete s[a]}),_.value.forEach(a=>{w(s[a])&&s[a].length>0&&(s[a]=JSON.parse(s[a]))}),A.value.forEach(a=>{w(s[a])&&(s[a]=parseFloat(s[a]))}),s}function te(t){return Object.entries(t).reduce((s,[a,n])=>(s[a]=n.map(u=>({name:u,params:{}})),s),{})}function G(t={}){return Object.entries(t).reduce((s,[a,n])=>(w(n)&&(B(a)?s[a]=n[0].value:m(a)?s[a]=n.map(u=>u.value):s[a]=n),s),{})}async function W(t,s){const a=i.value[t].options||{};if(a.server){const n=a.limit||5;return new Promise((u,c)=>{de.list(a.modelClass,{offset:s,limit:n}).then(e=>{const l=e.data,h={total:e.total,data:l.map(S=>({value:a.value(S),label:a.label(S)}))};u(R(t,s,n,h))})})}else return new Promise((n,u)=>{n(Object.assign({},{data:a,total:a.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ne(){return new Promise((t,s)=>{Promise.all(E.value.map(a=>{const n=i.value[a].offset||0;return W(a,n)})).then(a=>{const n={};a.forEach((u,c)=>{const e=E.value[c];n[e]=u}),t(n)}).catch(a=>{s(a)})})}return{schemasMap:i,clientOptionsFields:k,clientOptionsField:F,serverOptionsFields:E,serverOptionsField:J,selectableKeys:z,multiSelectableFields:V,singleSelectableFields:b,inputType:o,inputLabel:d,inputValue:M,inputableField:Q,multiInputableField:X,multiSelectableField:m,singleSelectableField:B,selectableField:L,nullToggleableField:$,nullToggleableFields:x,tagsField:H,tagsFields:I,objectField:N,objectFields:_,numberField:K,numberFields:A,includeKeys:y,formatInputOptionsData:R,formatDataFields:Y,formatDataForShow:D,formatDataForSave:ee,formatErrorsForDisplay:te,formatFilters:G,validateParams:T,fetchOptions:W,initOptionsData:ne}}const ze={class:"body"},xe={class:"data-row"},Ie={class:"field-input"},_e={key:0,class:"field-toggle"},Ae={key:0,class:"actions"},Le={__name:"Form",props:{modelValue:{type:Object,default:{}},fieldsLayout:{type:Array,default:[]},dataFields:{type:Array,default:[]},schemas:{type:Object,default:{}},errorMessages:{type:Object,default(){return{}}},compact:{type:Boolean,default:!1},submittable:{type:Boolean,default:!0},confirmButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-check",value:"Confirm"}}},cancelButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-xmark",value:"Cancel"}}}},emits:["update:modelValue","submit","cancel"],setup(f,{emit:i}){const k=f,{schemasMap:E,serverOptionsFields:z,inputType:V,inputLabel:b,inputableField:x,multiInputableField:I,multiSelectableField:_,singleSelectableField:A,nullToggleableField:p,nullToggleableFields:y,objectField:o,formatInputOptionsData:d,fetchOptions:M,initOptionsData:Q}=Pe(k.schemas),X=Se(),m=O({get:()=>k.modelValue,set:n=>{i("update:modelValue",n)}}),B=oe(y.value.reduce((n,u)=>(n[u]=!1,n),{}));function F(n){return!p(n)||B.value[n]}function L(n){return F(n)&&x(n)}function J(n){return F(n)&&(I(n)||o(n))}function $(n){return F(n)&&V(n)==="date"}function H(n){return F(n)&&V(n)==="datetime"}function N(n){return F(n)&&(V(n)==="enum"||V(n)==="select")}function K(n){return F(n)&&V(n)==="daterange"}function R(n){return F(n)&&V(n)==="datetimerange"}function Y(n){return F(n)&&V(n)==="boolean"}function T(n){return k.dataFields.find(u=>u===n)}function Z(n){return`Has ${b(n)}`}function j(n){return!k.errorMessages||!k.errorMessages[n]?"":k.errorMessages[n].map(u=>X[u.name](u.params)).join(", ")}const q=oe({});function D(n){return q.value[n]}function ee(n){return F(n)&&A(n)&&!!D(n)}function te(n){return F(n)&&_(n)&&!!D(n)}const G=O(()=>z.value.reduce((n,u)=>(n[u]=c=>{W(u,c)},n),{}));async function W(n,u){const c=E.value[n].limit||5;await M(n,u).then(e=>{q.value[n]=d(n,u,c,e)})}const ne=O(()=>k.compact?"form compact":"form");function t(n){return p(n)?"data-field toggleable":"data-field"}function s(){i("submit",m.value)}function a(){i("cancel")}return he(async()=>{await Q().then(n=>{q.value=n}).catch(n=>{errorAlert.value=!0,errorContent.value=JSON.stringify(n)})}),(n,u)=>(v(),P("div",{class:ce(r(ne))},[re("div",ze,[(v(!0),P(ue,null,le(f.fieldsLayout,c=>(v(),P("div",xe,[(v(!0),P(ue,null,le(Object.keys(c),e=>Oe(n.$slots,`form-col.${e}`,Ce(we({field:e,type:r(V)(e),label:r(b)(e)})),()=>[re("div",{class:ce(t(e))},[re("div",Ie,[L(e)?(v(),C(r(Ve),{key:0,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,type:r(V)(e),label:r(b)(e),size:c[e],disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","type","label","size","disabled","error-message"])):U("",!0),J(e)?(v(),C(r(Fe),{key:1,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):U("",!0),$(e)?(v(),C(r(ke),{key:2,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),disabled:!T(e),"align-pickers":"top","error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):U("",!0),H(e)?(v(),C(r(Te),{key:3,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),disabled:!T(e),"display-time":!0,"align-pickers":"top","error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):U("",!0),N(e)?(v(),C(r(je),{key:4,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),name:e,id:e,options:r(E)[e].options,size:c[e],disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","name","id","options","size","disabled","error-message"])):U("",!0),ee(e)?(v(),C(r(ie),{key:5,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),name:r(b)(e),multiple:!1,options:D(e).data,"options-length":D(e).total,"options-loading":D(e).loading,pagination:D(e).pagination,size:c[e],disabled:!T(e),"error-message":j(e),onOffsetChange:r(G)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):U("",!0),te(e)?(v(),C(r(ie),{key:6,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),name:r(b)(e),options:D(e).data,"options-length":D(e).total,"options-loading":D(e).loading,pagination:D(e).pagination,size:c[e],disabled:!T(e),"error-message":j(e),onOffsetChange:r(G)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):U("",!0),K(e)?(v(),C(r(De),{key:7,"start-date":r(m)[e].startDate,"onUpdate:startDate":l=>r(m)[e].startDate=l,"end-date":r(m)[e].endDate,"onUpdate:endDate":l=>r(m)[e].endDate=l,label:r(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["start-date","onUpdate:startDate","end-date","onUpdate:endDate","label","disabled","error-message"])):U("",!0),R(e)?(v(),C(r(Ue),{key:8,"start-time":r(m)[e].startTime,"onUpdate:startTime":l=>r(m)[e].startTime=l,"end-time":r(m)[e].endTime,"onUpdate:endTime":l=>r(m)[e].endTime=l,label:r(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["start-time","onUpdate:startTime","end-time","onUpdate:endTime","label","disabled","error-message"])):U("",!0),Y(e)?(v(),C(r(me),{key:9,modelValue:r(m)[e],"onUpdate:modelValue":l=>r(m)[e]=l,label:r(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):U("",!0)]),r(p)(e)?(v(),P("div",_e,[se(r(me),{modelValue:B.value[e],"onUpdate:modelValue":l=>B.value[e]=l,label:Z(e)},null,8,["modelValue","onUpdate:modelValue","label"])])):U("",!0)],2)],!0)),256))]))),256))]),f.submittable?(v(),P("div",Ae,[se(r(pe),{class:"button","button-type":f.confirmButton.type,value:f.confirmButton.value,icon:f.confirmButton.icon,onClick:u[0]||(u[0]=c=>s())},null,8,["button-type","value","icon"]),se(r(pe),{class:"button","button-type":f.cancelButton.type,value:f.cancelButton.value,icon:f.cancelButton.icon,onClick:u[1]||(u[1]=c=>a())},null,8,["button-type","value","icon"])])):U("",!0)],2))}},Ke=fe(Le,[["__scopeId","data-v-f7df8128"]]);export{Ke as F,Ee as a,Pe as u};
