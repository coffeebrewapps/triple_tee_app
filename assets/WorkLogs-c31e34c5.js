import{c as k,_ as ue,a as me,m as ge,u as pe,q as de,S as Le,r as f,w as We,o as Te,b as r,d as u,i as l,g as a,T as L,z as q,E as B,e as y,t as M,F as le,x as re,j as ie,D as he,p as ce,h as ve,v as ne,f as oe}from"./index-5d3b5062.js";import{u as be}from"./validations-9a1af222.js";import{_ as _e,D as Ee}from"./DataPage-c76c2d4f.js";import{T as xe}from"./TabContainer-f41a1449.js";import{u as $e}from"./input-f6942672.js";import"./errors-53bc63a8.js";import"./DataForm-9f3a2ac9.js";const{isEmpty:Ke,notEarlierThan:Ce}=be();function fe(){const c=[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"startTime",type:"datetime",label:"Start Time",defaultValue:()=>new Date,listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"endTime",type:"datetime",label:"End Time",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"description",type:"text",label:"Description",defaultValue:()=>"New Task",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"content",type:"textarea",label:"Content",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"tags",type:"multiSelect",label:"Tags",reference:{label:E},listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tags",value:F,label:E}}],W=[{startTime:"md",endTime:"md"},{description:"lg"},{content:"lg"},{tags:"lg"}],C={initData:{startTime:{startTime:null,endTime:null},endTime:{startTime:null,endTime:null}},layout:[{tags:"md"},{startTime:"md"},{endTime:"md"}]},T={create:{endTime:[g]},update:{endTime:[g]}};function F(o){return o.id}function E(o){return`${o.category}:${o.name}`}function g(o){return Ce(o,"endTime","startTime")}function v(o){if(o===0)return"0 h 0 m 0 s";const _=Math.floor(o/1e3/60/60/24),h=_*1e3*60*60*24,I=Math.floor((o-h)/1e3/60/60),m=I*1e3*60*60,A=Math.floor((o-h-m)/1e3/60),b=A*1e3*60,w=Math.floor((o-h-m-b)/1e3),V=[];return _>0&&V.push(`${_} d`),I>0&&V.push(`${I} h`),A>0&&V.push(`${A} m`),w>0&&V.push(`${w} s`),V.join(" ")}function x(o){return Ke(o.endTime)?new Date-new Date(o.startTime):new Date(o.endTime)-new Date(o.startTime)}const p=k(()=>c.filter(o=>o.reference)),N=k(()=>p.value.map(o=>o.key));return{dataFields:c,fieldsLayout:W,filters:C,validations:T,formatDuration:v,calculateDuration:x,includeKeys:N,recordValue:F,tagLabel:E}}const Ve=c=>(ce("data-v-7d96cb50"),c=c(),ve(),c),Me={class:"today-logs-container"},Fe={class:"controls"},Ne=["onKeydown"],Ie=["onKeydown"],Ae=["onKeydown"],Oe=["onKeydown"],je=["onKeydown"],Be={class:"logs"},He={class:"total"},Qe=Ve(()=>l("div",{class:"divider"},null,-1)),qe={class:"duration"},Ue={class:"start-time"},Pe={key:0,class:"end-time"},ze={key:1,class:"elapsed"},Ge={key:2,class:"elapsed"},Ye={class:"description"},Je={__name:"TodayLog",setup(c){const{isEmpty:W,notEmpty:C}=be(),T=me();ge();const{formatShortTime:F}=he(),{dataFields:E,fieldsLayout:g,validations:v,formatDuration:x,calculateDuration:p,includeKeys:N}=fe(),{formatDataFields:o,validateParams:_,formatDataForShow:h,formatDataForSave:I}=$e(E),{flashMessage:m}=pe(),A=de(),b=Le(),w=f([]),V=k(()=>E.map(e=>e.key)),$=f({}),Z=k(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}),ee=k(()=>{const e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e}),O=f([]),j=k(()=>O.value.length===0?!1:W($.value.endTime)&&t.value),J=k(()=>O.value.reduce((e,i)=>e+i.duration,0));function U(e){return e.map(i=>(i.duration=p(i),i))}function H(e){return W(e)?{}:(e.duration=p(e),e)}const s=f(!1),t=f(!1);function n(){return E.reduce((e,i)=>{const d=i.key,X=i.defaultValue;return C(X)?e[d]=X():e[d]=null,e},{})}function D(){$.value=n(),z.value="",s.value=!0}async function K(){$.value=n(),z.value="",await ye()}function P(){s.value=!1}async function ye(){const e=_(v.create,$.value);if(Object.keys(e).length>0){m("Error submitting task!");return}const i=I($.value);await T.create("work_logs",i).then(d=>{m("Started task successfully!"),R(),P()}).catch(d=>{console.error(d),m("Error creating data!")})}const Q=f(!1),z=f(""),S=f({});We(Q,(e,i)=>{e||(S.value={})});async function we(){const e=_(v.update,S.value);if(Object.keys(e).length>0){m("Error submitting task!");return}const i=I(S.value);await T.update("work_logs",S.value.id,i).then(d=>{m("Ended task successfully!"),R(),De(),z.value==="quick"?K():z.value==="input"&&setTimeout(D,1e3)}).catch(d=>{console.error(d),m("Error submiting task!")})}async function G(){S.value=Object.assign({},$.value),await h("startTime",S.value).then(e=>{S.value.startTime=e}),await h("tags",S.value).then(e=>{S.value.tags=e}),S.value.endTime=new Date,Q.value=!0}function te(){G(),z.value="input"}function ae(){G(),z.value="quick"}function De(){S.value={},Q.value=!1}const se=f(!1),Y=k(()=>se.value?"shortcut show":"shortcut hide");b.registerListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask",invoke:e=>{D()}}),b.registerListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask",invoke:e=>{K()}}),b.registerListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask",invoke:e=>{G()}}),b.registerListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask",invoke:e=>{te()}}),b.registerListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask",invoke:e=>{ae()}}),b.registerListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs",invoke:e=>{s.value&&(s.value=!1),Q.value&&(Q.value=!1)}}),A.registerListener("loadTodayLogs",{id:"TodayLog",invoke:e=>{R()}}),A.registerListener("toggleShortcut",{id:"ToggleTodayLogShortcut",invoke:e=>{se.value=!se.value}});async function Se(){await T.schemas("work_logs").then(e=>{const i=e.fields;w.value=o(i)}).catch(e=>{m("Error loading schemas!"),console.log(e)})}async function R(){const e={include:N.value,filters:{startTime:{startDate:Z.value,endDate:ee.value}},sort:{field:"startTime",order:"desc"}};await T.list("work_logs",e).then(i=>{O.value=U(i.data),$.value=H(O.value[0]),C($.value.startTime)&&(t.value=!0)}).catch(i=>{m("Error loading work logs!"),console.log(i)})}return Te(async()=>{await R(),await Se()}),(e,i)=>(r(),u("div",Me,[l("div",Fe,[a(j)?y("",!0):(r(),u("div",{key:0,class:"button",tabindex:"0",onClick:D,onKeydown:L(D,["enter"])},[q(" Start New Task "),l("div",{class:B(a(Y))}," N ",2)],40,Ne)),a(j)?y("",!0):(r(),u("div",{key:1,class:"button",tabindex:"0",onClick:K,onKeydown:L(K,["enter"])},[q(" Quick Start New Task "),l("div",{class:B(a(Y))}," Q ",2)],40,Ie)),a(j)?(r(),u("div",{key:2,class:"button",tabindex:"0",onClick:G,onKeydown:L(G,["enter"])},[q(" End Current Task "),l("div",{class:B(a(Y))}," E ",2)],40,Ae)):y("",!0),a(j)?(r(),u("div",{key:3,class:"button",tabindex:"0",onClick:te,onKeydown:L(te,["enter"])},[q(" End and Start New "),l("div",{class:B(a(Y))}," G ",2)],40,Oe)):y("",!0),a(j)?(r(),u("div",{key:4,class:"button",tabindex:"0",onClick:ae,onKeydown:L(ae,["enter"])},[q(" End and Quick Start "),l("div",{class:B(a(Y))}," F ",2)],40,je)):y("",!0)]),l("div",Be,[l("div",He," Today's total: "+M(a(x)(a(J))),1),(r(!0),u(le,null,re(O.value,(d,X)=>(r(),u("div",{key:X,class:"log"},[Qe,l("div",qe,[l("div",Ue,M(a(F)(d.startTime)),1),a(C)(d.endTime)?(r(),u("div",Pe," to "+M(a(F)(d.endTime)),1)):y("",!0),a(C)(d.endTime)?(r(),u("div",ze," ("+M(a(x)(d.duration))+") ",1)):y("",!0),a(W)(d.endTime)?(r(),u("div",Ge," (not ended) ")):y("",!0)]),l("div",Ye,M(d.description),1)]))),128))]),ie(_e,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=d=>s.value=d),schemas:w.value,"fields-layout":a(g),"data-fields":a(V),data:$.value,fullscreen:!0,"dialog-title":"Start Task",onSubmit:ye},null,8,["modelValue","schemas","fields-layout","data-fields","data"]),ie(_e,{modelValue:Q.value,"onUpdate:modelValue":i[1]||(i[1]=d=>Q.value=d),schemas:w.value,"fields-layout":a(g),"data-fields":a(V),data:S.value,fullscreen:!0,"dialog-title":"End Task",onSubmit:we},null,8,["modelValue","schemas","fields-layout","data-fields","data"])]))}},Re=ue(Je,[["__scopeId","data-v-7d96cb50"]]);const ke=c=>(ce("data-v-27ec4c7d"),c=c(),ve(),c),Xe={class:"weekly-tab-container"},Ze={class:"weekly-tabs"},et=["onKeydown"],tt=ke(()=>l("i",{class:"fa-solid fa-angle-left"},null,-1)),at=["onKeydown"],st=["onKeydown"],nt=ke(()=>l("i",{class:"fa-solid fa-angle-right"},null,-1)),ot={class:"weekly-tab-content"},lt={key:0,class:"total"},rt={key:1,class:"total"},it={class:"timeline"},ut=ke(()=>l("div",{class:"divider"},null,-1)),dt={class:"heading"},ct={class:"date"},vt={key:0,class:"duration"},ft={key:1,class:"duration"},kt={class:"entries"},yt={key:0},_t={class:"description"},mt={class:"duration"},gt={__name:"WeekLog",props:{loadData:{type:Boolean,default:!1}},setup(c){const W=me();ge();const{formatLongDate:C}=he(),{formatDuration:T,calculateDuration:F}=fe(),{flashMessage:E}=pe(),g=de(),v=f("this"),x=f({}),p=f(0),N=f("prevWeekTab"),o=f("thisWeekTab"),_=f("nextWeekTab"),h=k(()=>{const s=new Date,t=new Date,n=p.value*7;return v.value==="prev"?(t.setDate(t.getDate()+n),t.setDate(t.getDate()-s.getDay())):(v.value==="next"&&t.setDate(t.getDate()+n),t.setDate(t.getDate()-s.getDay())),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t}),I=k(()=>{const s=new Date;return s.setDate(h.value.getDate()+6),s.setHours(23),s.setMinutes(59),s.setSeconds(59),s}),m=k(()=>Array.from(Array(7)).map((s,t)=>{const n=new Date(h.value);return n.setDate(h.value.getDate()+t),n.setHours(0),n.setMinutes(0),n.setSeconds(0),n})),A=k(()=>({startTime:{startDate:h.value,endDate:I.value}})),b=k(()=>Object.entries(x.value).reduce((s,[t,{total:n}])=>s+n,0));function w(s){return x.value[s]?x.value[s]:{total:0,entries:[]}}function V(s){const t=m.value.reduce((n,D)=>(n[D]={entries:[],total:0},n),{});return s.forEach(n=>{const D=new Date(n.startTime),K=new Date(D.getFullYear(),D.getMonth(),D.getDate(),0,0,0),P=F(n);t[K].entries.push(Object.assign({},n,{duration:P})),t[K].total=t[K].total+P}),t}g.registerListener("loadWeeklyLogs",{id:"WeekLog",invoke:s=>{H()}});const $=k(()=>v.value==="prev"?"weekly-tab active":"weekly-tab"),Z=k(()=>v.value==="this"?"weekly-tab active":"weekly-tab"),ee=k(()=>v.value==="next"?"weekly-tab active":"weekly-tab");async function O(){p.value=p.value-1,v.value="prev",N.value.blur(),await H()}async function j(){p.value=0,v.value="this",o.value.blur(),await H()}async function J(){p.value=p.value+1,v.value="next",_.value.blur(),await H()}function U(s){s==="prev"?N.value.focus():s==="next"?_.value.focus():o.value.focus()}async function H(){const s={filters:A.value};await W.list("work_logs",s).then(t=>{x.value=V(t.data)}).catch(t=>{E("Error loading work logs!"),console.log(t)})}return Te(async()=>{await H()}),(s,t)=>(r(),u("div",Xe,[l("div",Ze,[l("div",{ref_key:"prevWeekTab",ref:N,class:B(a($)),tabindex:"0",onClick:O,onKeydown:[L(O,["enter"]),t[0]||(t[0]=L(n=>U("this"),["arrow-right"]))]},[tt,q(" Prev Week ")],42,et),l("div",{ref_key:"thisWeekTab",ref:o,class:B(a(Z)),tabindex:"0",onClick:j,onKeydown:[L(j,["enter"]),t[1]||(t[1]=L(n=>U("prev"),["arrow-left"])),t[2]||(t[2]=L(n=>U("next"),["arrow-right"]))]}," This Week ",42,at),l("div",{ref_key:"nextWeekTab",ref:_,class:B(a(ee)),tabindex:"0",onClick:J,onKeydown:[L(J,["enter"]),t[3]||(t[3]=L(n=>U("this"),["arrow-left"]))]},[q(" Next Week "),nt],42,st)]),l("div",ot,[a(b)>0?(r(),u("div",lt," Week's total: "+M(a(T)(a(b))),1)):y("",!0),a(b)===0?(r(),u("div",rt," Week's total: 0 h 0 m 0 s ")):y("",!0),l("div",it,[(r(!0),u(le,null,re(a(m),(n,D)=>(r(),u("div",{key:D,class:"day"},[ut,l("div",dt,[l("div",ct,M(a(C)(n)),1),w(n).total>0?(r(),u("div",vt," ("+M(a(T)(w(n).total))+") ",1)):y("",!0),w(n).total===0?(r(),u("div",ft," (0 h 0 m 0 s) ")):y("",!0)]),l("div",kt,[w(n).entries.length===0?(r(),u("div",yt," No entry ")):y("",!0),(r(!0),u(le,null,re(w(n).entries,(K,P)=>(r(),u("div",{key:P,class:"entry"},[l("div",_t,M(K.description),1),l("div",mt,M(a(T)(K.duration)),1)]))),128))])]))),128))])])]))}},pt=ue(gt,[["__scopeId","data-v-27ec4c7d"]]);const Tt=c=>(ce("data-v-9949f1bb"),c=c(),ve(),c),ht={class:"view-container"},bt=Tt(()=>l("h2",{class:"heading"}," Time Tracking ",-1)),wt={__name:"WorkLogs",setup(c){const W=de(),{dataFields:C,fieldsLayout:T,filters:F,validations:E}=fe(),g=f(0),v=[{label:"Today",onchange:x},{label:"Weekly",onchange:p},{label:"All Logs",onchange:N}];function x(){W.emitEvent("loadTodayLogs",{})}function p(){W.emitEvent("loadWeeklyLogs",{})}function N(){W.emitEvent("loadData",{dataType:"Work Logs"})}async function o(_){await v[_].onchange(),g.value=_}return(_,h)=>(r(),u("div",ht,[bt,ie(xe,{tabs:v,"selected-tab":g.value,onTabChange:o},{"tab-0":ne(()=>[g.value===0?(r(),oe(Re,{key:0})):y("",!0)]),"tab-1":ne(()=>[g.value===1?(r(),oe(pt,{key:0})):y("",!0)]),"tab-2":ne(()=>[g.value===2?(r(),oe(Ee,{key:0,"model-class":"work_logs","data-type":"Work Logs",fullscreen:!0,"fields-layout":a(T),"data-fields":a(C),validations:a(E),filters:a(F)},null,8,["fields-layout","data-fields","validations","filters"])):y("",!0)]),_:1},8,["selected-tab"])]))}},Kt=ue(wt,[["__scopeId","data-v-9949f1bb"]]);export{Kt as default};
