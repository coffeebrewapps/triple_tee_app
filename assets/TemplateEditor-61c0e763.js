import{_ as ce,n as de,a as re,M as ue,r as a,c as p,o as pe,b as f,d as D,i as t,j as O,v as h,E,g as l,t as v,e as y,f as P,z as fe,N as ve,B as _e,s as me,R as he,O as ye,p as be,h as ke}from"./index-b39c9af0.js";import{u as ge}from"./validations-9a1af222.js";import{T as Ee}from"./TabContainer-6460e9ac.js";const o=s=>(be("data-v-47746345"),s=s(),ke(),s),Se={class:"preview-template"},we={class:"template-editor"},Ce=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Te=[Ce],Me=["contenteditable"],De=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Pe=[De],xe=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Re=[xe],Ne={key:0,class:"error-message"},Ve=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Be=[Ve],je=["contenteditable"],Le=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Oe=[Le],Ge=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ie=[Ge],Ae={key:0,class:"error-message"},Fe=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Ue=[Fe],qe=["contenteditable"],ze=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),He=[ze],Je=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),$e=[Je],Ke={class:"preview-container"},Qe=o(()=>t("h3",{class:"heading"}," Preview ",-1)),We=["innerHTML"],Xe={class:"buttons"},Ye=o(()=>t("div",{class:"message"}," Generating PDF... ",-1)),Ze={__name:"TemplateEditor",props:{id:{type:String,default:null},contentMarkup:{type:String,default:""},contentStyles:{type:String,default:""},disabled:{type:Boolean,default:!1},data:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},enableGenerate:{type:Boolean,default:!0},templateType:{type:String,default:null}},emits:["contentMarkupChange","contentStylesChange","dataChange"],setup(s,{emit:S}){const n=s,w=de(),G=re(),{notEmpty:x}=ge(),I=new ue,A=a("style"),R=p(()=>({contentMarkup:n.contentMarkup,contentStyles:n.contentStyles})),N=a(0),F=[{label:"Markup"},{label:"Styles"},{label:"Data"}];function U(e){N.value=e}const C=a("markupEditor"),V=a("stylesEditor"),T=a("sampleDataEditor"),d=a(!1),r=a(!1),u=a(!1),q=p(()=>{const e=[];return e.push("editor"),d.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),z=p(()=>{const e=[];return e.push("editor"),r.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),H=p(()=>{const e=[];return e.push("editor"),u.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")});function J(){d.value=!0}async function $(){m.value=!1,await M().then(e=>{te()}).catch(e=>{m.value=!0,_.value="Markup error",console.log(e)}).finally(()=>{d.value=!1})}function K(){r.value=!0}function Q(){ae(),r.value=!1}function W(){u.value=!0}async function X(){m.value=!1,await M().then(e=>{se()}).catch(e=>{m.value=!0,_.value="Sample data error",console.log(e)}).finally(()=>{u.value=!1})}function Y(){d.value=!d.value}function Z(){r.value=!r.value}function ee(){u.value=!u.value}function te(){S("contentMarkupChange",C.value.innerText)}function ae(){S("contentStylesChange",V.value.innerText)}function se(){const e=T.value.innerText;x(e)&&S("dataChange",JSON.parse(e))}const B=p(()=>n.data),ne=p(()=>m.value?"preview-content error":"preview-content"),_=a(),m=a(!1);async function M(){return new Promise((e,i)=>{_.value=null;const c=T.value.innerText;x(c)?I.parseAndRender(C.value.innerText,JSON.parse(c)).then(g=>{_.value=g,e(g)}).catch(g=>{i(g)}):e()})}const b=a(!1),k=a(),j=a(),L=a();async function oe(){k.value=null,b.value=!0,await G.downloadStream(n.templateType,n.id,B.value,{path:"pdf"}).then(e=>{const i=new Blob([e.data],{type:"application/pdf"}),c=window.URL.createObjectURL(i);j.value=c,L.value=`${n.templateType}_${n.id}.pdf`,k.value=c,le()}).catch(e=>{console.log(e)}).finally(()=>{ie()})}function le(){const e=Object.assign({},w.currentRoute.value),i={path:"/document_templates/:templateType/:id/pdf",name:"View Pdf",component:()=>ye(()=>import("./PdfViewer-726c9dee.js"),["assets/PdfViewer-726c9dee.js","assets/index-b39c9af0.js","assets/index-a43d2e85.css","assets/PdfViewer-652058bc.css"]),props:{templatePdfData:k.value,downloadLink:j.value,downloadFile:L.value},meta:{parentRoute:{name:e.name},hidden:!0}};w.addRoute(i),w.push({name:"View Pdf",params:{templateType:n.templateType,id:n.id}})}function ie(){b.value=!1}return pe(async()=>{await M()}),(e,i)=>(f(),D("div",Se,[t("div",we,[O(Ee,{"selected-tab":N.value,tabs:F,onTabChange:U},{"tab-0":h(()=>[t("div",{class:E(l(q))},[t("div",{class:"editor-button cancel",onClick:Y},Te),t("div",{ref_key:"markupEditor",ref:C,class:"editor-content",contenteditable:d.value},v(l(R).contentMarkup),9,Me),t("div",{class:"editor-button edit",onClick:J},Pe),t("div",{class:"editor-button confirm",onClick:$},Re)],2),s.errorMessages.contentMarkup?(f(),D("div",Ne,v(s.errorMessages.contentMarkup),1)):y("",!0)]),"tab-1":h(()=>[t("div",{class:E(l(z))},[t("div",{class:"editor-button cancel",onClick:Z},Be),t("div",{ref_key:"stylesEditor",ref:V,class:"editor-content",contenteditable:r.value},v(l(R).contentStyles),9,je),t("div",{class:"editor-button edit",onClick:K},Oe),t("div",{class:"editor-button confirm",onClick:Q},Ie)],2),s.errorMessages.contentStyles?(f(),D("div",Ae,v(s.errorMessages.contentStyles),1)):y("",!0)]),"tab-2":h(()=>[t("div",{class:E(l(H))},[t("div",{class:"editor-button cancel",onClick:ee},Ue),t("div",{ref_key:"sampleDataEditor",ref:T,class:"editor-content",contenteditable:u.value},v(l(B)),9,qe),t("div",{class:"editor-button edit",onClick:W},He),t("div",{class:"editor-button confirm",onClick:X},$e)],2)]),_:1},8,["selected-tab"])]),t("div",Ke,[Qe,t("div",{class:E(l(ne)),innerHTML:_.value},null,10,We),s.contentStyles?(f(),P(ve(A.value),{key:0},{default:h(()=>[fe(v(s.contentStyles),1)]),_:1})):y("",!0),t("div",Xe,[s.enableGenerate?(f(),P(l(_e),{key:0,value:"Generate",icon:"fa-solid fa-file-export",onClick:oe})):y("",!0)])]),O(l(he),{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=c=>b.value=c),class:"generate-dialog",title:"Generating PDF",width:400,height:250},{body:h(()=>[k.value?y("",!0):(f(),P(l(me),{key:0})),Ye]),_:1},8,["modelValue"])]))}},st=ce(Ze,[["__scopeId","data-v-47746345"]]);export{st as T};
