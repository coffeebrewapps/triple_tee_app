import{_ as ce,m as de,a as re,v as ue,M as pe,r as a,b as p,d as fe,o as f,c as M,j as t,k as B,q as h,E,g as l,t as v,e as y,f as P,s as ve,O as _e,$ as me,D as he,P as ye,Q as be,p as ke,i as ge}from"./index-b3ed4318.js";import{T as Ee}from"./TabContainer-41a4bb62.js";const o=s=>(ke("data-v-552bf28a"),s=s(),ge(),s),Se={class:"preview-template"},we={class:"template-editor"},Ce=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),Te=[Ce],De=["contenteditable"],Me=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Pe=[Me],xe=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ne=[xe],Ve={key:0,class:"error-message"},Re=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),je=[Re],Le=["contenteditable"],Oe=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),Be=[Oe],Ge=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),Ie=[Ge],Ae={key:0,class:"error-message"},Fe=o(()=>t("i",{class:"fa-solid fa-xmark"},null,-1)),$e=[Fe],qe=["contenteditable"],Ue=o(()=>t("i",{class:"fa-solid fa-pencil"},null,-1)),He=[Ue],Je=o(()=>t("i",{class:"fa-solid fa-check"},null,-1)),ze=[Je],Qe={class:"preview-container"},Ke=o(()=>t("h3",{class:"heading"}," Preview ",-1)),We=["innerHTML"],Xe={class:"buttons"},Ye=o(()=>t("div",{class:"message"}," Generating PDF... ",-1)),Ze={__name:"TemplateEditor",props:{id:{type:String,default:null},contentMarkup:{type:String,default:""},contentStyles:{type:String,default:""},disabled:{type:Boolean,default:!1},data:{type:Object,default(){return{}}},errorMessages:{type:Object,default(){return{}}},enableGenerate:{type:Boolean,default:!0},templateType:{type:String,default:null}},emits:["contentMarkupChange","contentStylesChange","dataChange"],setup(s,{emit:S}){const n=s,w=de(),G=re(),{notEmpty:x}=ue(),I=new pe,A=a("style"),N=p(()=>({contentMarkup:n.contentMarkup,contentStyles:n.contentStyles})),V=a(0),F=[{label:"Markup"},{label:"Styles"},{label:"Data"}];function $(e){V.value=e}const C=a("markupEditor"),R=a("stylesEditor"),T=a("sampleDataEditor"),d=a(!1),r=a(!1),u=a(!1),q=p(()=>{const e=[];return e.push("editor"),d.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),U=p(()=>{const e=[];return e.push("editor"),r.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")}),H=p(()=>{const e=[];return e.push("editor"),u.value&&e.push("editable"),n.disabled&&e.push("disabled"),e.join(" ")});function J(){d.value=!0}async function z(){m.value=!1,await D().then(e=>{te()}).catch(e=>{m.value=!0,_.value="Markup error",console.error(e)}).finally(()=>{d.value=!1})}function Q(){r.value=!0}function K(){ae(),r.value=!1}function W(){u.value=!0}async function X(){m.value=!1,await D().then(e=>{se()}).catch(e=>{m.value=!0,_.value="Sample data error",console.error(e)}).finally(()=>{u.value=!1})}function Y(){d.value=!d.value}function Z(){r.value=!r.value}function ee(){u.value=!u.value}function te(){S("contentMarkupChange",C.value.innerText)}function ae(){S("contentStylesChange",R.value.innerText)}function se(){const e=T.value.innerText;x(e)&&S("dataChange",JSON.parse(e))}const j=p(()=>n.data),ne=p(()=>m.value?"preview-content error":"preview-content"),_=a(),m=a(!1);async function D(){return new Promise((e,i)=>{_.value=null;const c=T.value.innerText;x(c)?I.parseAndRender(C.value.innerText,JSON.parse(c)).then(g=>{_.value=g,e(g)}).catch(g=>{i(g)}):e()})}const b=a(!1),k=a(),L=a(),O=a();async function oe(){k.value=null,b.value=!0,await G.downloadStream(n.templateType,n.id,j.value,{path:"pdf"}).then(e=>{const i=new Blob([e.data],{type:"application/pdf"}),c=window.URL.createObjectURL(i);L.value=c,O.value=`${n.templateType}_${n.id}.pdf`,k.value=c,le()}).catch(e=>{console.error(e)}).finally(()=>{ie()})}function le(){const e=Object.assign({},w.currentRoute.value),i={path:"/document_templates/:templateType/:id/pdf",name:"View Pdf",component:()=>be(()=>import("./PdfViewer-d2c7d078.js"),["assets/PdfViewer-d2c7d078.js","assets/index-b3ed4318.js","assets/index-e8f250ad.css","assets/PdfViewer-652058bc.css"]),props:{templatePdfData:k.value,downloadLink:L.value,downloadFile:O.value},meta:{parentRoute:{name:e.name},hidden:!0}};w.addRoute(i),w.push({name:"View Pdf",params:{templateType:n.templateType,id:n.id}})}function ie(){b.value=!1}return fe(async()=>{await D()}),(e,i)=>(f(),M("div",Se,[t("div",we,[B(Ee,{"selected-tab":V.value,tabs:F,onTabChange:$},{"tab-0":h(()=>[t("div",{class:E(l(q))},[t("div",{class:"editor-button cancel",onClick:Y},Te),t("div",{ref_key:"markupEditor",ref:C,class:"editor-content",contenteditable:d.value},v(l(N).contentMarkup),9,De),t("div",{class:"editor-button edit",onClick:J},Pe),t("div",{class:"editor-button confirm",onClick:z},Ne)],2),s.errorMessages.contentMarkup?(f(),M("div",Ve,v(s.errorMessages.contentMarkup),1)):y("",!0)]),"tab-1":h(()=>[t("div",{class:E(l(U))},[t("div",{class:"editor-button cancel",onClick:Z},je),t("div",{ref_key:"stylesEditor",ref:R,class:"editor-content",contenteditable:r.value},v(l(N).contentStyles),9,Le),t("div",{class:"editor-button edit",onClick:Q},Be),t("div",{class:"editor-button confirm",onClick:K},Ie)],2),s.errorMessages.contentStyles?(f(),M("div",Ae,v(s.errorMessages.contentStyles),1)):y("",!0)]),"tab-2":h(()=>[t("div",{class:E(l(H))},[t("div",{class:"editor-button cancel",onClick:ee},$e),t("div",{ref_key:"sampleDataEditor",ref:T,class:"editor-content",contenteditable:u.value},v(l(j)),9,qe),t("div",{class:"editor-button edit",onClick:W},He),t("div",{class:"editor-button confirm",onClick:X},ze)],2)]),_:1},8,["selected-tab"])]),t("div",Qe,[Ke,t("div",{class:E(l(ne)),innerHTML:_.value},null,10,We),s.contentStyles?(f(),P(_e(A.value),{key:0},{default:h(()=>[ve(v(s.contentStyles),1)]),_:1})):y("",!0),t("div",Xe,[s.enableGenerate?(f(),P(l(me),{key:0,value:"Generate",icon:"fa-solid fa-file-export",onClick:oe})):y("",!0)])]),B(l(ye),{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=c=>b.value=c),class:"generate-dialog",title:"Generating PDF",width:400,height:250},{body:h(()=>[k.value?y("",!0):(f(),P(l(he),{key:0})),Ye]),_:1},8,["modelValue"])]))}},at=ce(Ze,[["__scopeId","data-v-552bf28a"]]);export{at as T};
