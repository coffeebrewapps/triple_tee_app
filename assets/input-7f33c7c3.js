import{a as re,l as ae,c as d,B as se}from"./index-4d73f140.js";function ue(){function v(i){return!s(i)}function s(i){return Object.is(i,void 0)||Object.is(i,null)}function j(i,p,r){const l=i[p],k=i[r];if(!(!l||!k)&&l<k)return{name:"earlierThan",params:{compareDate:r}}}function h(i,p){const r=i[p];if(!r)return;if(r>new Date)return{name:"futureDate",params:{}}}function E(i,p){const r=i[p];if(!r)return;if(r<new Date)return{name:"futureDate",params:{}}}function F(i,p,r){const l=i[p];if(!s(l)&&!(l>r))return{name:"greaterThan",params:{compareValue:r}}}function T(i,p,r){const l=i[p];if(!s(l)&&!(l>=r))return{name:"greaterThanOrEqual",params:{compareValue:r}}}function S(i,p,r){const l=i[p];if(!s(l)&&!(l<r))return{name:"lessThan",params:{compareValue:r}}}function w(i,p,r){const l=i[p];if(!s(l)&&!(l<=r))return{name:"lessThanOrEqual",params:{compareValue:r}}}return Object.assign({},{notEmpty:v,isEmpty:s},{notEarlierThan:j,futureDate:h,pastDate:E},{greaterThan:F,greaterThanOrEqual:T,lessThan:S,lessThanOrEqual:w})}const H=re(),oe=ae(),L=oe.getSystemConfigs(),{formatDate:ce,formatTimestamp:ie}=se(),{isEmpty:x,notEmpty:g}=ue();function fe(v){const s=d(()=>v.reduce((e,n)=>(e[n.key]=n,e),{})),j=d(()=>Object.keys(s.value).filter(e=>A(e))),h=d(()=>Object.keys(s.value).filter(e=>M(e))),E=d(()=>Object.keys(s.value).filter(e=>P(e))),F=d(()=>Object.keys(s.value).filter(e=>y(e))),T=d(()=>Object.keys(s.value).filter(e=>D(e))),S=d(()=>Object.keys(s.value).filter(e=>z(e))),w=d(()=>Object.keys(s.value).filter(e=>J(e))),C=d(()=>Object.keys(s.value).filter(e=>I(e))),V=d(()=>Object.keys(s.value).filter(e=>K(e))),i=d(()=>v.filter(e=>e.reference)),p=d(()=>i.value.map(e=>e.key));function r(e){return(s.value[e]||{}).type}function l(e){return(s.value[e]||{}).label}function k(e,n,t,a){const u=t.find(o=>o===e),c=n[e];if(!x(c))if(g(u)){const o=n.includes||{},f=[c].flat().filter(b=>!!b).map(b=>{const O=o[e][b];return s.value[e].reference.label(O)});return y(e)?f:f[0]}else return r(e)==="enum"||r(e)==="select"?a.find(f=>f.key===e).options.find(f=>f.value===c).label:r(e)==="datetime"?ie(c,L.timezone):r(e)==="date"?ce(c,L.timezone):c}function G(e){return r(e)==="text"||r(e)==="number"}function Q(e){return r(e)==="textarea"}function y(e){return r(e)==="multiSelect"}function D(e){return r(e)==="singleSelect"}function A(e){return r(e)==="select"||r(e)==="enum"}function P(e){return r(e)==="select"||r(e)==="multiSelect"||r(e)==="singleSelect"||r(e)==="enum"}function M(e){return P(e)&&s.value[e].options&&s.value[e].options.server}function z(e){return s.value[e].nullToggleable}function J(e){return e==="tags"||Object.is(s.value[e].isTags,!0)}function I(e){return r(e)==="object"}function K(e){return r(e)==="number"}function N(e,n,t,a){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},a)}function R(e){return v.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,a=Object.keys(t).map(c=>({value:c,label:t[c]}));return Object.assign({},n,{options:a})}else return n})}function U(e,n){return Object.keys(e).reduce((t,a)=>{const c=e[a].map(o=>o(n)).filter(o=>!!o);return c.length>0&&(t[a]=c),t},{})}async function W(e,n){return H.view(e,n,{})}async function X(e,n){const t=s.value[e].options,a=t.modelClass,u=n.map(c=>W(a,c));return new Promise((c,o)=>{Promise.all(u).then(m=>{const f=m.map(b=>{const O=t.value(b),q=t.label(b);return{value:O,label:q}});c(f)}).catch(m=>{console.error(m),o(m)})})}function Y(e,n){const t=n[e];if(g(t))return t;const a=s.value[e].defaultValue;return g(a)?a():t}async function Z(e,n){return new Promise((t,a)=>{const u=Y(e,n);if(x(u)){t(u);return}if(I(e)){g(u)?t(JSON.stringify(u,!1,4)):t(u);return}if(r(e)!=="date"&&r(e)!=="datetime"&&!y(e)&&!D(e)){t(u);return}if(r(e)==="date"||r(e)==="datetime"){let o;u instanceof Date||typeof u=="string"?o=new Date(u):o=Object.entries(u).reduce((m,[f,b])=>(g(b)?m[f]=new Date(b):m[f]=b,m),{}),t(o);return}const c=[u].flat();if(g(n.includes)&&g(n.includes[e])&&Object.keys(n.includes[e]).length>0){const o=n.includes[e],m=c.map(f=>{const b=o[f],O=s.value[e].options,q=O.value(b),ne=O.label(b);return{value:q,label:ne}});t(m)}else X(e,c).then(o=>{t(o)}).catch(o=>{console.error(o);const m=[];c.forEach(f=>{g(f)&&m.push({value:f,label:f})}),t(m)})})}function _(e){const n=Object.assign({},e);return F.value.forEach(t=>{const a=n[t]||[];n[t]=a.map(u=>u.value)}),T.value.forEach(t=>{const a=n[t]||[];n[t]=(a[0]||{}).value}),j.value.forEach(t=>{const a=n[t];(x(a)||a.length===0)&&delete n[t]}),C.value.forEach(t=>{g(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),V.value.forEach(t=>{g(n[t])&&(n[t]=parseFloat(n[t]))}),n}function $(e){return Object.entries(e).reduce((n,[t,a])=>(n[t]=a.map(u=>({name:u,params:{}})),n),{})}function ee(e={}){return Object.entries(e).reduce((n,[t,a])=>(g(a)&&a!==""&&(D(t)?n[t]=a[0].value:y(t)?n[t]=a.map(u=>u.value):n[t]=a),n),{})}async function B(e,n){const t=s.value[e].options||{};if(t.server){const a=t.limit||5;return new Promise((u,c)=>{H.list(t.modelClass,{offset:n,limit:a}).then(o=>{const m=o.data,b={total:o.total,data:m.map(O=>({value:t.value(O),label:t.label(O)}))};u(N(e,n,a,b))})})}else return new Promise((a,u)=>{a(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function te(){return new Promise((e,n)=>{Promise.all(h.value.map(t=>{const a=s.value[t].offset||0;return B(t,a)})).then(t=>{const a={};t.forEach((u,c)=>{const o=h.value[c];a[o]=u}),e(a)}).catch(t=>{n(t)})})}return{schemasMap:s,clientOptionsFields:j,clientOptionsField:A,serverOptionsFields:h,serverOptionsField:M,selectableKeys:E,multiSelectableFields:F,singleSelectableFields:T,inputType:r,inputLabel:l,inputValue:k,inputableField:G,multiInputableField:Q,multiSelectableField:y,singleSelectableField:D,selectableField:P,nullToggleableField:z,nullToggleableFields:S,tagsField:J,tagsFields:w,objectField:I,objectFields:C,numberField:K,numberFields:V,includeKeys:p,formatInputOptionsData:N,formatDataFields:R,formatDataForShow:Z,formatDataForSave:_,formatErrorsForDisplay:$,formatFilters:ee,validateParams:U,fetchOptions:B,initOptionsData:te}}export{ue as a,fe as u};
