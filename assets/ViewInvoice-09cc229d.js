import{u as z}from"./input-811f8f86.js";import{v as O,b as I,o as i,f as y,g as a,_ as G,a as J,C as Q,u as R,n as W,r as v,d as X,c as o,j as E,t as V,D as Y,e as u,q as x,F as j,y as M}from"./index-b3ed4318.js";import{u as Z}from"./utils-c659d292.js";import{T as ee}from"./TabContainer-41a4bb62.js";import{D as te}from"./DataPage-4999849a.js";import{T as ae}from"./TemplateEditor-6070bea0.js";import"./errors-53bc63a8.js";import"./DataForm-ebf3e12e.js";const ne={__name:"InvoiceLines",props:{invoiceId:{type:String,default:null}},setup(m){const p=m,{greaterThanOrEqual:l}=O(),f=[{description:"lg"},{unit:"md",unitCost:"md",subtotal:"md"},{invoiceId:"lg"}],g=I(()=>[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"description",type:"text",label:"Description",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0},{key:"unit",type:"enum",label:"Unit",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"unitCost",type:"number",label:"Unit Cost",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"subtotal",type:"number",label:"Subtotal",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"invoiceId",type:"singleSelect",label:"Invoice",reference:{label:s},listable:!1,viewable:!0,creatable:!0,updatable:!1,filterable:!0,options:{server:!0,pagination:!0,modelClass:"invoices",value:h,label:s}}]);function h(e){return e.id}function s(e){return`Invoice #${e.invoiceNumber}`}const k={create:{unitCost:[e=>l(e,"unitCost",0)],subtotal:[e=>l(e,"subtotal",0)]},update:{unitCost:[e=>l(e,"unitCost",0)],subtotal:[e=>l(e,"subtotal",0)]}},C=I(()=>{const e={};return p.invoiceId&&(e.invoiceId=[{value:p.invoiceId}]),e.description=null,{initData:e,layout:[{invoiceId:"lg",description:"lg"}]}});return(e,w)=>(i(),y(te,{"model-class":"invoice_lines","data-type":"Invoice Lines","fields-layout":f,"data-fields":a(g),validations:k,filters:a(C)},null,8,["data-fields","filters"]))}};const ie={class:"page-container"},oe={class:"heading"},le={key:0,class:"details-container"},se={class:"field-label"},ce={class:"field-value"},ue={key:0},re={key:1},de={__name:"ViewInvoice",props:{contactId:{type:String,default:null},invoiceId:{type:String,default:null}},setup(m){const p=m,l=J(),{isEmpty:f,notEmpty:g}=O(),h=Q(),{flashMessage:s}=R(),k=W(),{fieldsLayout:C,generateDataFields:e}=Z(),w=I(()=>e(p.contactId)),{inputLabel:U,inputValue:$,includeKeys:N}=z(w.value),n=v(),L=v(),D=v(),r=v(),F=v(),A=I(()=>n.value?`Invoice: ${n.value.invoiceNumber}`:"Loading Invoice...");async function B(){n.value=null;const t={include:N.value};await l.view("invoices",p.invoiceId,t).then(d=>{n.value=d,s("Loaded invoice successfully!")}).catch(d=>{console.error(d),s("Error loading invoice!")})}async function P(){L.value=null,D.value=null,r.value=null,l.view("invoices",n.value.id,{},{path:"template_data"}).then(t=>{L.value=t.invoiceLines,D.value=t.invoiceConfig,r.value=t.invoiceTemplate;const d=t.invoiceNumberSequence,S=t.currency,T=t.billingContact,c=t.country,_=t.logo;F.value={invoice:n.value,invoiceLines:L.value,invoiceConfig:D.value,invoiceNumberSequence:d,billingContact:Object.assign({},T,{country:c.countryName,logo:_.rawData}),currency:S,country:c,logo:_},s("Loaded template data successfully!")}).catch(t=>{console.error(t),s("Error loading template data!")})}const b=v(0),q=[{label:"Details",onchange:B},{label:"Invoice Lines",onchange:H},{label:"View Invoice PDF",onchange:P}];async function H(){h.emitEvent("loadData",{dataType:"Invoice Lines"})}async function K(t){await q[t].onchange(),b.value=t}return X(async()=>{await B()}),(t,d)=>(i(),o("div",ie,[E("h2",oe,V(a(A)),1),n.value?u("",!0):(i(),y(a(Y),{key:0})),n.value?(i(),y(ee,{key:1,"selected-tab":b.value,tabs:q,onTabChange:K},{"tab-0":x(()=>[b.value===0?(i(),o("div",le,[(i(!0),o(j,null,M(a(C),(S,T)=>(i(),o("div",{key:T,class:"data-row"},[(i(!0),o(j,null,M(Object.keys(S),(c,_)=>(i(),o("div",{key:_,class:"data-field"},[E("div",se,V(a(U)(c)),1),E("div",ce,[a(g)(n.value)&&a(g)(n.value[c])?(i(),o("span",ue,V(a($)(c,n.value,a(N),a(w),a(k))),1)):u("",!0),a(f)(n.value)||a(f)(n.value[c])?(i(),o("span",re," --- no value --- ")):u("",!0)])]))),128))]))),128))])):u("",!0)]),"tab-1":x(()=>[b.value===1?(i(),y(ne,{key:0,"invoice-id":m.invoiceId},null,8,["invoice-id"])):u("",!0)]),"tab-2":x(()=>[b.value===2&&r.value?(i(),y(ae,{key:0,id:r.value.id,"template-type":"invoice_templates","content-markup":r.value.contentMarkup,"content-styles":r.value.contentStyles,data:F.value,disabled:!0},null,8,["id","content-markup","content-styles","data"])):u("",!0)]),_:1},8,["selected-tab"])):u("",!0)]))}},Ie=G(de,[["__scopeId","data-v-9f80368d"]]);export{Ie as default};
