import{a as ue,l as re,c as f,B as le}from"./index-196d7642.js";import{u as oe}from"./validations-83886343.js";const k=ue(),ce=re(),J=ce.getSystemConfigs(),{formatDate:ie,formatTimestamp:me}=le(),{isEmpty:O,notEmpty:p}=oe();function be(F){const l=f(()=>F.reduce((e,n)=>(e[n.key]=n,e),{})),V=f(()=>Object.keys(l.value).filter(e=>P(e))),j=f(()=>Object.keys(l.value).filter(e=>T(e))),K=f(()=>Object.keys(l.value).filter(e=>d(e))),D=f(()=>Object.keys(l.value).filter(e=>g(e))),w=f(()=>Object.keys(l.value).filter(e=>y(e))),N=f(()=>Object.keys(l.value).filter(e=>I(e))),B=f(()=>Object.keys(l.value).filter(e=>x(e))),E=f(()=>Object.keys(l.value).filter(e=>h(e))),C=f(()=>Object.keys(l.value).filter(e=>A(e))),H=f(()=>Object.keys(l.value).filter(e=>v(e))),L=f(()=>F.filter(e=>e.reference||e.file)),q=f(()=>L.value.map(e=>e.key));function c(e){return(l.value[e]||{}).type}function G(e){return(l.value[e]||{}).label}function Q(e,n,t,s){const a=t.find(u=>u===e),o=n[e];if(!O(o))if(p(a)&&!v(e)){const u=n.includes||{},i=[o].flat().filter(m=>!!m).map(m=>{const b=u[e][m];return l.value[e].reference.label(b)});return g(e)?i:i[0]}else return c(e)==="enum"||c(e)==="select"?s.find(i=>i.key===e).options.find(i=>i.value===o).label:c(e)==="datetime"?me(o,J.timezone):c(e)==="date"?ie(o,J.timezone):v(e)?((n.includes||{})[e][o]||{}).rawData:o}function R(e){return c(e)==="text"||c(e)==="number"}function U(e){return c(e)==="textarea"}function g(e){return c(e)==="multiSelect"}function y(e){return c(e)==="singleSelect"}function P(e){return c(e)==="select"||c(e)==="enum"}function d(e){return c(e)==="select"||c(e)==="multiSelect"||c(e)==="singleSelect"||c(e)==="enum"}function T(e){return d(e)&&l.value[e].options&&l.value[e].options.server}function I(e){return l.value[e].nullToggleable}function x(e){return e==="tags"||Object.is(l.value[e].isTags,!0)}function h(e){return c(e)==="object"}function A(e){return c(e)==="number"}function v(e){return c(e)==="file"}function M(e,n,t,s){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},s)}function W(e){return F.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,s=Object.keys(t).map(o=>({value:o,label:t[o]}));return Object.assign({},n,{options:s})}else return n})}function X(e,n){return Object.keys(e).reduce((t,s)=>{const o=e[s].map(u=>u(n)).filter(u=>!!u);return o.length>0&&(t[s]=o),t},{})}async function Y(e,n){return k.view(e,n,{})}async function Z(e,n){const t=l.value[e].options,s=t.modelClass,a=n.map(o=>Y(s,o));return new Promise((o,u)=>{Promise.all(a).then(r=>{const i=r.map(m=>{const b=t.value(m),S=t.label(m);return{value:b,label:S}});o(i)}).catch(r=>{console.error(r),u(r)})})}function _(e,n){const t=n[e];if(p(t))return t;const s=l.value[e].defaultValue;return p(s)?s():t}async function $(e,n){return new Promise((t,s)=>{const a=_(e,n);if(O(a)){t(a);return}if(h(e)){p(a)?t(JSON.stringify(a,!1,4)):t(a);return}if(v(e)){const u=l.value[e].file;if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const r=n.includes[e][a];t(u.label(r))}else k.view(u.modelClass,a,{}).then(r=>{O(n.includes[e])&&(n.includes[e]={}),n.includes[e][a]=r,t(u.label(r))}).catch(r=>{console.error(r),t(a)});return}if(c(e)!=="date"&&c(e)!=="datetime"&&!g(e)&&!y(e)){t(a);return}if(c(e)==="date"||c(e)==="datetime"){let u;a instanceof Date||typeof a=="string"?u=new Date(a):u=Object.entries(a).reduce((r,[i,m])=>(p(m)?r[i]=new Date(m):r[i]=m,r),{}),t(u);return}const o=[a].flat();if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const u=n.includes[e],r=o.map(i=>{const m=u[i],b=l.value[e].options,S=b.value(m),ae=b.label(m);return{value:S,label:ae}});t(r)}else Z(e,o).then(u=>{t(u)}).catch(u=>{console.error(u);const r=[];o.forEach(i=>{p(i)&&r.push({value:i,label:i})}),t(r)})})}function ee(e){const n=Object.assign({},e);return D.value.forEach(t=>{const s=n[t]||[];n[t]=s.map(a=>a.value)}),w.value.forEach(t=>{const s=n[t]||[];n[t]=(s[0]||{}).value}),V.value.forEach(t=>{const s=n[t];(O(s)||s.length===0)&&delete n[t]}),E.value.forEach(t=>{p(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),C.value.forEach(t=>{p(n[t])&&(n[t]=parseFloat(n[t]))}),n}function te(e){return Object.entries(e).reduce((n,[t,s])=>(n[t]=s.map(a=>({name:a,params:{}})),n),{})}function ne(e={}){return Object.entries(e).reduce((n,[t,s])=>(p(s)&&s!==""&&(y(t)?n[t]=s[0].value:g(t)?n[t]=s.map(a=>a.value):n[t]=s),n),{})}async function z(e,n){const t=l.value[e].options||{};if(t.server){const s=t.limit||5;return new Promise((a,o)=>{k.list(t.modelClass,{offset:n,limit:s}).then(u=>{const r=u.data,m={total:u.total,data:r.map(b=>({value:t.value(b),label:t.label(b)}))};a(M(e,n,s,m))})})}else return new Promise((s,a)=>{s(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function se(){return new Promise((e,n)=>{Promise.all(j.value.map(t=>{const s=l.value[t].offset||0;return z(t,s)})).then(t=>{const s={};t.forEach((a,o)=>{const u=j.value[o];s[u]=a}),e(s)}).catch(t=>{n(t)})})}return{schemasMap:l,clientOptionsFields:V,clientOptionsField:P,serverOptionsFields:j,serverOptionsField:T,selectableKeys:K,multiSelectableFields:D,singleSelectableFields:w,inputType:c,inputLabel:G,inputValue:Q,inputableField:R,multiInputableField:U,multiSelectableField:g,singleSelectableField:y,selectableField:d,nullToggleableField:I,nullToggleableFields:N,tagsField:x,tagsFields:B,objectField:h,objectFields:E,numberField:A,numberFields:C,fileField:v,fileFields:H,includeKeys:q,formatInputOptionsData:M,formatDataFields:W,formatDataForShow:$,formatDataForSave:ee,formatErrorsForDisplay:te,formatFilters:ne,validateParams:X,fetchOptions:z,initOptionsData:se}}export{be as u};
