import{_ as re,m as ge,r as _,o as oe,b as s,d as r,i as w,t as g,F as q,x as Q,g as u,e as c,P as Te,D as he,n as _e,a as Ie,u as ke,c as P,f as Y,j as S,B as we,v as E,C as N,E as $,z as ne,H as Ve,Q as Fe,p as Pe,h as Ee}from"./index-f257e624.js";import{u as Z}from"./input-d149c8ec.js";import{u as ee}from"./validations-9a1af222.js";import{u as Ae}from"./errors-53bc63a8.js";import{u as De}from"./utils-71d9759b.js";const{greaterThanOrEqual:V,compareMoreThan:se}=ee();function Se(){const d=[{minIncome:"md",maxIncome:"md"},{maxPayableAmount:"md",rate:"md"},{taxTableId:"lg"}];function I(a){return a.id}function x(a){return a.description}function A(a){return[{key:"id",type:"text",label:"ID",listable:!0,viewable:!1,creatable:!1,updatable:!1,sortable:!0},{key:"minIncome",type:"number",label:"Minimum Income",listable:!0,viewable:!0,creatable:!0,updatable:!0,sortable:!0},{key:"maxIncome",type:"number",label:"Maximum Income",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"maxPayableAmount",type:"number",label:"Maximum Payable Amount",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"rate",type:"number",label:"Rate",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"taxTableId",type:"singleSelect",label:"Tax Table",reference:{label:x},defaultValue:()=>a,listable:!0,viewable:!0,creatable:!0,updatable:!1,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tax_tables",value:I,label:x}}]}return{fieldsLayout:d,recordValue:I,taxTableLabel:x,generateDataFields:A,validations:{create:{minIncome:[a=>V(a,"minIncome",0)],maxIncome:[a=>V(a,"minIncome",0),a=>se(a,"maxIncome","minIncome")],maxPayableAmount:[a=>V(a,"maxPayableAmount",0)],rate:[a=>V(a,"rate",0)]},update:{minIncome:[a=>V(a,"minIncome",0)],maxIncome:[a=>V(a,"minIncome",0),a=>se(a,"maxIncome","minIncome")],maxPayableAmount:[a=>V(a,"maxPayableAmount",0)],rate:[a=>V(a,"rate",0)]}}}}const $e={class:"view-container"},Ce={class:"heading"},Ue={class:"details-container"},je={class:"field-label"},Le={key:0,class:"field-value"},Me={key:0},Be={key:1},Oe={key:1,class:"field-value"},ze={key:0,class:"no-value"},Ke={__name:"ViewPage",props:{heading:{type:String,default:null},fieldsLayout:{type:Array,default(){return[]}},dataFields:{type:Array,default(){return[]}},data:{type:Object,default(){return{}}}},setup(d){const I=d,{includeKeys:x,inputLabel:A,inputValue:D,tagsField:a}=Z(I.dataFields),{isEmpty:C,notEmpty:k}=ee(),{formatTag:G,tagStyle:U}=he(),j=ge().getSystemConfigs();async function J(){const T=[];I.dataFields.length>0?b.value=I.dataFields.reduce((v,y)=>{const p=y.key;return v[p]=I.data[p],a(p)&&T.push(W(I.data,p)),v},{}):b.value={},Promise.all(T).then(v=>{v.forEach(y=>{const p=`${y.key}Formatted`;b.value[p]=y.tags})})}const b=_({});async function W(T,v){const p=(T[v]||[]).map(i=>new Promise((o,h)=>{G(T,i,v,j.tagFormat).then(f=>{o(f)}).catch(f=>{h(f)})}));return new Promise((i,o)=>{Promise.all(p).then(h=>{i({key:v,tags:h})}).catch(h=>{o(h)})})}function L(T,v){const y=`${T}Formatted`;return(b.value[y]||[])[v]}return oe(async()=>{await J()}),(T,v)=>(s(),r("div",$e,[w("h2",Ce,g(d.heading),1),w("div",Ue,[(s(!0),r(q,null,Q(d.fieldsLayout,(y,p)=>(s(),r("div",{key:p,class:"data-row"},[(s(!0),r(q,null,Q(Object.keys(y),(i,o)=>(s(),r("div",{key:o,class:"data-field"},[w("div",je,g(u(A)(i)),1),u(a)(i)?c("",!0):(s(),r("div",Le,[u(k)(d.data)&&u(k)(d.data[i])?(s(),r("span",Me,g(u(D)(i,d.data,u(x),d.dataFields)),1)):c("",!0),u(C)(d.data)||u(C)(d.data[i])?(s(),r("span",Be," --- no value --- ")):c("",!0)])),u(a)(i)?(s(),r("div",Oe,[(s(!0),r(q,null,Q(d.data[i],(h,f)=>(s(),r("div",{key:f,class:"tag",style:Te(u(U)(d.data,h,i))},g(L(i,f)),5))),128)),d.data[i].length===0?(s(),r("div",ze," --- no value --- ")):c("",!0)])):c("",!0)]))),128))]))),128))])]))}},Re=re(Ke,[["__scopeId","data-v-7aae95c2"]]);const ue=d=>(Pe("data-v-0e5e0eac"),d=d(),Ee(),d),He={class:"page-container"},Ne={class:"tax-table-actions"},qe={key:0,class:"error-message"},Qe=ue(()=>w("div",{class:"divider"},null,-1)),Ge={key:0},Je={key:0},We={key:0},Xe={key:0},Ye={key:0},Ze={key:0},ea={class:"actions"},aa=["onClick"],ta={class:"tooltip"},la=ue(()=>w("div",null,null,-1)),na={__name:"ViewTaxTable",setup(d){const I=_e(),x=Ie(),{notEmpty:A}=ee(),D=Ae(),{flashMessage:a}=ke(),C=Object.assign({},I.currentRoute.value),k=P(()=>C.params.id),G=P(()=>b.value?`Tax Table: ${b.value.description}`:"Tax Table"),U=De(),ae=P(()=>U.fieldsLayout),j=P(()=>U.dataFields),J=Z(j.value),b=_();async function W(){b.value=null;const e={include:J.includeKeys.value};await x.view("tax_tables",k.value,e).then(t=>{b.value=t,a("Loaded tax table successfully!")}).catch(t=>{console.error(t),a("Error loading tax table!")})}const L=Se(),T=P(()=>{const e=L.generateDataFields(k.value),t=e.findIndex(n=>n.key==="taxTableId");e.splice(t,1);const l=e.findIndex(n=>n.key==="id");return e.splice(l,1),e}),v=L.validations.create,y=Z(T.value),p=y.updatableKeys,i=_([]),o=_([]),h=_(!1),f=_([]),M=_(),te=_(""),B=_(!1);async function O(){h.value=!0,i.value=[],o.value=[],f.value=[],await x.list("tax_tiers",{filters:{taxTableId:k.value},sort:{field:"minIncome",order:"asc"}}).then(e=>{i.value=e.data,o.value=e.data.map(t=>!1),f.value=o.value.map(t=>""),a("Loaded tax tiers successfully!")}).catch(e=>{console.error(e),a("Error loading tax tiers!")}).finally(()=>{h.value=!1})}const ie=[{name:"Add",icon:"fa-solid fa-circle-plus fa-xl",click:async function(e){await de()}}],ce=[{name:"Edit",icon:"fa-solid fa-pencil",click:async function(e,t){o.value[t]=!0},show:function(e,t){return!o.value[t]}},{name:"Save",icon:"fa-solid fa-check",click:async function(e,t){await ve(e,t)},show:function(e,t){return o.value[t]}},{name:"Cancel",icon:"fa-solid fa-xmark",click:async function(e,t){o.value[t]=!1},show:function(e,t){return o.value[t]}},{name:"Delete",icon:"fa-solid fa-trash-can",click:async function(e,t){await ye(e,t)},show:function(e,t){return!0}}];async function de(){i.value.push({id:null,minIncome:null,maxIncome:null,maxPayableAmount:null,rate:null,taxTableId:k.value}),o.value.push(!0),f.value.push({})}function me(e){const t=p.value.reduce((l,n)=>(l[n]=e[n],l),{});return y.formatDataForSave(t)}function z(e,t){return(f.value[e][t]||[]).map(n=>D[n.name](n.params)).join(", ")}async function ve(e,t){const l=me(e);f.value[t]={};const n=y.validateParams(v,l);if(Object.keys(n).length>0){f.value[t]=n;return}e.id?await x.update("tax_tiers",e.id,Object.assign({},l,{taxTableId:k.value})).then(m=>{O(),o.value[t]=!1,a(`Saved tax tier ${e.id} successfully!`)}).catch(m=>{console.error(m),a(`Error saving tax tier ${e.id}!`)}):await x.create("tax_tiers",Object.assign({},l,{taxTableId:k.value})).then(m=>{O(),o.value[t]=!1,a("Saved tax tier successfully!")}).catch(m=>{console.error(m),a("Error saving tax tier!")})}async function ye(e,t){M.value=t,B.value=!0,te.value=`Are you sure you want to delete tier row ${t+1}?`}async function fe(){const e=M.value,t=i.value[e];t.id?await x.remove("tax_tiers",t.id).then(l=>{O(),a("Deleted tax tier successfully!")}).catch(l=>{console.error(l),a("Error deleting tax tier!")}):i.value.splice(e,1),le()}function le(){B.value=!1,M.value=null}function xe(e){return(e*100).toFixed(2)}const F=_(),K=_();async function be(){F.value=null,K.value=null,await x.view("tax_tables",k.value,{},{path:"estimate"}).then(e=>{F.value=e,a("Estimated tax successfully!")}).catch(e=>{console.error(e),K.value=Object.entries(e).map(([t,l])=>l.map(n=>`${t} ${D[n]()}`).join(`
`)).join(`
`),a("Error estimating tax!")})}function X(e){return A(F.value)&&F.value.incomeBracket.id===e.id}const R=P(()=>i.value.map(e=>X(e)?"row-field payable":"row-field"));return oe(async()=>{await W(),await O()}),(e,t)=>(s(),r("div",He,[b.value?(s(),Y(Re,{key:0,heading:u(G),"fields-layout":u(ae),"data-fields":u(j),data:b.value},null,8,["heading","fields-layout","data-fields","data"])):c("",!0),w("div",Ne,[S(u(we),{icon:"fa-solid fa-calculator",value:"Estimate Tax",onClick:be}),K.value?(s(),r("div",qe," Estimate Tax Error: "+g(K.value),1)):c("",!0)]),Qe,b.value?(s(),Y(u(Ve),{key:1,name:"Tax Tiers",headers:u(T),data:i.value,"table-actions":ie,actions:ce,loading:h.value,pagination:{offset:0,limit:i.value.length,client:!0}},{["data-col.minIncome"]:E(({row:l,i:n})=>[o.value[n]?(s(),r("div",Ge,[S(u(N),{modelValue:l.minIncome,"onUpdate:modelValue":m=>l.minIncome=m,type:"number",label:"",size:"md","error-message":z(n,"minIncome")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):c("",!0),o.value[n]?c("",!0):(s(),r("div",{key:1,class:$(u(R)[n])},g(l.minIncome.toFixed(2)),3))]),["data-col.maxIncome"]:E(({row:l,i:n})=>[o.value[n]?(s(),r("div",Je,[S(u(N),{modelValue:l.maxIncome,"onUpdate:modelValue":m=>l.maxIncome=m,type:"number",label:"",size:"md","error-message":z(n,"maxIncome")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):c("",!0),o.value[n]?c("",!0):(s(),r("div",{key:1,class:$(u(R)[n])},[ne(g(l.maxIncome.toFixed(2))+" ",1),X(l)?(s(),r("span",We," (Nett Income: "+g(F.value.nettIncome.toFixed(2))+") ",1)):c("",!0)],2))]),["data-col.maxPayableAmount"]:E(({row:l,i:n})=>[o.value[n]?(s(),r("div",Xe,[S(u(N),{modelValue:l.maxPayableAmount,"onUpdate:modelValue":m=>l.maxPayableAmount=m,type:"number",label:"",size:"md","error-message":z(n,"maxPayableAmount")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):c("",!0),o.value[n]?c("",!0):(s(),r("div",{key:1,class:$(u(R)[n])},[ne(g(l.maxPayableAmount.toFixed(2))+" ",1),X(l)?(s(),r("span",Ye," (Payable: "+g(F.value.payable.toFixed(2))+") ",1)):c("",!0)],2))]),["data-col.rate"]:E(({row:l,i:n})=>[o.value[n]?(s(),r("div",Ze,[S(u(N),{modelValue:l.rate,"onUpdate:modelValue":m=>l.rate=m,type:"number",label:"",size:"md","error-message":z(n,"rate")},null,8,["modelValue","onUpdate:modelValue","error-message"])])):c("",!0),o.value[n]?c("",!0):(s(),r("div",{key:1,class:$(u(R)[n])},g(xe(l.rate))+"% ",3))]),"data-actions":E(({row:l,actions:n,i:m})=>[w("div",ea,[(s(!0),r(q,null,Q(n,(H,pe)=>(s(),r("div",{key:pe},[H.show(l,m)?(s(),r("div",{key:0,class:"action tooltipable",onClick:sa=>H.click(l,m)},[w("i",{class:$(H.icon)},null,2),w("span",ta,g(H.name),1)],8,aa)):c("",!0)]))),128))])]),pagination:E(()=>[la]),_:2},1032,["headers","data","loading","pagination"])):c("",!0),M.value?(s(),Y(u(Fe),{key:2,modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=l=>B.value=l),title:"Delete Tier","primary-text":te.value,"secondary-text":"",width:500,height:250,class:"delete-dialog",onConfirm:fe,onCancel:le},null,8,["modelValue","primary-text"])):c("",!0)]))}},da=re(na,[["__scopeId","data-v-0e5e0eac"]]);export{da as default};
