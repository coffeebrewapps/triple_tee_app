import{D as T}from"./DataForm-c9afdb67.js";import{_ as U,a as j,l as L,u as N,r as v,c as n,o as P,b as _,d as $,f as A,g as l,e as K,i as H,j as O,M as R}from"./index-456a89cc.js";import{u as q}from"./input-701303c2.js";import"./errors-a6177d44.js";const G={class:"view-container"},J={class:"actions"},Q={__name:"SystemConfigs",setup(W){const c=j(),C=L(),u=N(),s=v(),i=v({}),d=n(()=>r.value.filter(e=>e.updatable)),m=n(()=>d.value.map(e=>e.key)),h=[{tagFormat:"md",timezone:"md"},{baseCurrencyId:"lg",baseContactId:"lg"}];function f(e){return e.id}function b(e){return`${e.code} (${e.symbol})`}function p(e){return e.name}const r=n(()=>[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"tagFormat",type:"text",label:"Tag Format",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"timezone",type:"text",label:"Timezone",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"baseCurrencyId",type:"singleSelect",label:"Base Currency",reference:{label:b},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"currencies",value:f,label:b}},{key:"baseContactId",type:"singleSelect",label:"Base Contact",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,options:{server:!0,pagination:!0,modelClass:"contacts",value:f,label:p}}]),{formatDataForShow:k,formatDataForSave:w,formatErrorsForDisplay:S}=q(r.value);function F(){return{tagFormat:"{{ category }}:{{ name }}",timezone:"UTC",baseCurrencyId:[],baseContactId:[]}}async function D(){const e=w(Object.assign({},s.value));await c.create("system_configs",e,{path:"replace"}).then(t=>{o("Updated config successfully!"),C.updateSystemConfigs(t)}).catch(t=>{console.error(t),i.value=S(t),o("Error updating config!")})}async function B(e){const t=m.value.map(a=>k(a,e));return new Promise((a,y)=>{Promise.all(t).then(V=>{const g={};d.value.forEach((E,z)=>{const M=E.key;g[M]=V[z]}),a(g)})})}async function I(){return new Promise((e,t)=>{c.list("system_configs",{},{path:"latest"}).then(a=>{const y=a.record;e(y)}).catch(a=>{t(a)})})}function o(e){u.show(e),setTimeout(x,5e3)}function x(){u.hide()}return P(async()=>{await I().then(e=>{e?B(e).then(t=>{s.value=t}):s.value=F()}).catch(e=>{console.error(e),o("Error loading config!")})}),(e,t)=>(_(),$("div",G,[s.value?(_(),A(T,{key:0,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),"fields-layout":h,"data-fields":l(m),schemas:l(r),"error-messages":i.value,submittable:!1},null,8,["modelValue","data-fields","schemas","error-messages"])):K("",!0),H("div",J,[O(l(R),{class:"button",value:"Update",icon:"fa-solid fa-check",onClick:t[1]||(t[1]=a=>D())})])]))}},te=U(Q,[["__scopeId","data-v-414c731e"]]);export{te as default};
