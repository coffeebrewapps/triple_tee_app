import{a as pe,c as o,D as be}from"./index-b39c9af0.js";import{u as ve}from"./validations-9a1af222.js";const V=pe(),{formatDate:ye,formatTimestamp:Oe}=be(),{isEmpty:g,notEmpty:p}=ve();function de(d){const r=o(()=>d.reduce((e,n)=>(e[n.key]=n,e),{})),w=o(()=>Object.values(r.value).filter(e=>e.listable)),L=o(()=>w.value.map(e=>e.key)),D=o(()=>Object.values(r.value).filter(e=>e.viewable)),q=o(()=>D.value.map(e=>e.key)),S=o(()=>Object.values(r.value).filter(e=>e.creatable)),B=o(()=>S.value.map(e=>e.key)),E=o(()=>Object.values(r.value).filter(e=>e.updatable)),G=o(()=>E.value.map(e=>e.key)),Q=o(()=>Object.values(r.value).some(e=>e.type==="file")),P=o(()=>Object.keys(r.value).filter(e=>A(e))),j=o(()=>Object.keys(r.value).filter(e=>C(e))),R=o(()=>Object.keys(r.value).filter(e=>h(e))),K=o(()=>Object.keys(r.value).filter(e=>v(e))),T=o(()=>Object.keys(r.value).filter(e=>F(e))),U=o(()=>Object.keys(r.value).filter(e=>M(e))),W=o(()=>Object.keys(r.value).filter(e=>z(e))),I=o(()=>Object.keys(r.value).filter(e=>k(e))),x=o(()=>Object.keys(r.value).filter(e=>J(e))),X=o(()=>Object.keys(r.value).filter(e=>y(e))),Y=o(()=>d.filter(e=>e.reference||e.file)),Z=o(()=>Y.value.map(e=>e.key));function c(e){return(r.value[e]||{}).type}function _(e){return(r.value[e]||{}).label}function $(e,n,t,a,u){const i=t.find(l=>l===e),s=n[e];if(!g(s))if(p(i)&&!y(e)){const l=n.includes||{},m=[s].flat().filter(b=>!!b).map(b=>{const O=l[e][b];return r.value[e].reference.label(O)});return v(e)?m:m[0]}else return c(e)==="enum"||c(e)==="select"?a.find(m=>m.key===e).options.find(m=>m.value===s).label:c(e)==="datetime"?Oe(s,u.timezone):c(e)==="date"?ye(s,u.timezone):y(e)?((n.includes||{})[e][s]||{}).rawData:s}function ee(e){return c(e)==="text"||c(e)==="number"}function te(e){return c(e)==="textarea"}function v(e){return c(e)==="multiSelect"}function F(e){return c(e)==="singleSelect"}function A(e){return c(e)==="select"||c(e)==="enum"}function h(e){return c(e)==="select"||c(e)==="multiSelect"||c(e)==="singleSelect"||c(e)==="enum"}function C(e){return h(e)&&r.value[e].options&&r.value[e].options.server}function M(e){return r.value[e].nullToggleable}function z(e){return e==="tags"||Object.is(r.value[e].isTags,!0)}function k(e){return c(e)==="object"}function J(e){return c(e)==="number"}function y(e){return c(e)==="file"}function N(e,n,t,a){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},a)}function ne(e){return d.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,a=Object.keys(t).map(i=>({value:i,label:t[i]}));return Object.assign({},n,{options:a})}else return n})}function ae(e,n){return Object.keys(e).reduce((t,a)=>{const i=e[a].map(s=>s(n)).filter(s=>!!s);return i.length>0&&(t[a]=i),t},{})}async function ue(e,n){return V.view(e,n,{})}async function se(e,n){const t=r.value[e].options,a=t.modelClass,u=n.map(i=>ue(a,i));return new Promise((i,s)=>{Promise.all(u).then(l=>{const f=l.map(m=>{const b=t.value(m),O=t.label(m);return{value:b,label:O}});i(f)}).catch(l=>{console.error(l),s(l)})})}function re(e,n){const t=n[e];if(p(t))return t;const a=r.value[e].defaultValue;return p(a)?a():t}async function le(e,n){return new Promise((t,a)=>{const u=re(e,n);if(g(u)){t(u);return}if(k(e)){p(u)?t(JSON.stringify(u,!1,4)):t(u);return}if(y(e)){const s=r.value[e].file;if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const l=n.includes[e][u];t(s.label(l))}else V.view(s.modelClass,u,{}).then(l=>{g(n.includes[e])&&(n.includes[e]={}),n.includes[e][u]=l,t(s.label(l))}).catch(l=>{console.error(l),t(u)});return}if(c(e)!=="date"&&c(e)!=="datetime"&&!v(e)&&!F(e)){t(u);return}if(c(e)==="date"||c(e)==="datetime"){let s;u instanceof Date||typeof u=="string"?s=new Date(u):s=Object.entries(u).reduce((l,[f,m])=>(p(m)?l[f]=new Date(m):l[f]=m,l),{}),t(s);return}const i=[u].flat();if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const s=n.includes[e],l=i.map(f=>{const m=s[f],b=r.value[e].options,O=b.value(m),fe=b.label(m);return{value:O,label:fe}});t(l)}else se(e,i).then(s=>{t(s)}).catch(s=>{console.error(s);const l=[];i.forEach(f=>{p(f)&&l.push({value:f,label:f})}),t(l)})})}function ce(e){const n=Object.assign({},e);return K.value.forEach(t=>{const a=n[t]||[];n[t]=a.map(u=>u.value)}),T.value.forEach(t=>{const a=n[t]||[];n[t]=(a[0]||{}).value}),P.value.forEach(t=>{const a=n[t];(g(a)||a.length===0)&&delete n[t]}),I.value.forEach(t=>{p(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),x.value.forEach(t=>{p(n[t])&&(n[t]=parseFloat(n[t]))}),n}function oe(e){return Object.entries(e).reduce((n,[t,a])=>(n[t]=a.map(u=>({name:u,params:{}})),n),{})}function ie(e={}){return Object.entries(e).reduce((n,[t,a])=>(p(a)&&a!==""&&(F(t)?n[t]=a[0].value:v(t)?n[t]=a.map(u=>u.value):n[t]=a),n),{})}async function H(e,n){const t=r.value[e].options||{};if(t.server){const a=t.limit||5;return new Promise((u,i)=>{V.list(t.modelClass,{offset:n,limit:a}).then(s=>{const l=s.data,m={total:s.total,data:l.map(b=>({value:t.value(b),label:t.label(b)}))};u(N(e,n,a,m))})})}else return new Promise((a,u)=>{a(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function me(){return new Promise((e,n)=>{Promise.all(j.value.map(t=>{const a=r.value[t].offset||0;return H(t,a)})).then(t=>{const a={};t.forEach((u,i)=>{const s=j.value[i];a[s]=u}),e(a)}).catch(t=>{n(t)})})}return{schemasMap:r,listableFields:w,listableKeys:L,viewableFields:D,viewableKeys:q,creatableFields:S,creatableKeys:B,updatableFields:E,updatableKeys:G,multipartData:Q,clientOptionsFields:P,clientOptionsField:A,serverOptionsFields:j,serverOptionsField:C,selectableKeys:R,multiSelectableFields:K,singleSelectableFields:T,inputType:c,inputLabel:_,inputValue:$,inputableField:ee,multiInputableField:te,multiSelectableField:v,singleSelectableField:F,selectableField:h,nullToggleableField:M,nullToggleableFields:U,tagsField:z,tagsFields:W,objectField:k,objectFields:I,numberField:J,numberFields:x,fileField:y,fileFields:X,includeKeys:Z,formatInputOptionsData:N,formatDataFields:ne,formatDataForShow:le,formatDataForSave:ce,formatErrorsForDisplay:oe,formatFilters:ie,validateParams:ae,fetchOptions:H,initOptionsData:me}}export{de as u};
