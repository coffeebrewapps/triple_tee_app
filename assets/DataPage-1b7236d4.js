import{u as Qe}from"./input-991d0442.js";import{r,c as v,b as u,d as f,j as U,v as M,g as o,A as Se,R as Ae,l as Ge,F as G,_ as We,m as Xe,o as Ye,f as I,i as x,x as oe,t as j,e as m,P as Ze,B as Oe,D as _e,a as Qt,u as Gt,q as Wt,w as Ce,E as Je,z as Ie,J as Me,K as ze,L as He,H as Xt,Q as Yt,p as Zt,h as _t}from"./index-f8b7dd22.js";import{u as ea}from"./errors-53bc63a8.js";import{u as et}from"./validations-9a1af222.js";import{D as tt}from"./DataForm-e3fe8786.js";const qe={__name:"FormDialog",props:{modelValue:{type:Boolean,default:!1},fieldsLayout:{type:Array,default(){return[]}},dataFields:{type:Array,default(){return[]}},data:{type:Object,default(){return{}}},schemas:{type:Object,default(){return{}}},dialogTitle:{type:String,default:""},fullscreen:{type:Boolean,default:!1},errorMessages:{type:Object,default(){return{}}}},emits:["update:modelValue","submit"],setup(l,{emit:n}){const b=l,P=r(!1),z=r(""),w=v({get:()=>b.modelValue,set:S=>{n("update:modelValue",S)}}),L=v(()=>b.data);function R(S){n("submit",S)}function H(){w.value=!1,n("update:modelValue",!1)}return(S,D)=>(u(),f(G,null,[U(o(Ae),{modelValue:o(w),"onUpdate:modelValue":D[1]||(D[1]=g=>Se(w)?w.value=g:null),title:l.dialogTitle,fullscreen:l.fullscreen,class:"form-dialog"},{body:M(()=>[U(tt,{modelValue:o(L),"onUpdate:modelValue":D[0]||(D[0]=g=>Se(L)?L.value=g:null),"fields-layout":l.fieldsLayout,"data-fields":l.dataFields,schemas:l.schemas,"error-messages":l.errorMessages,onSubmit:R,onCancel:H},null,8,["modelValue","fields-layout","data-fields","schemas","error-messages"])]),_:1},8,["modelValue","title","fullscreen"]),U(o(Ge),{modelValue:P.value,"onUpdate:modelValue":D[2]||(D[2]=g=>P.value=g),title:"Error",content:z.value,width:400,height:250},null,8,["modelValue","content"])],64))}};const ta={class:"data-row"},aa={class:"data-label"},la={key:0,class:"data-value"},na={key:0},oa={key:1,class:"no-value"},sa={key:1,class:"data-value tags"},ra={key:0,class:"no-value"},ua={__name:"ViewDialog",props:{modelValue:{type:Boolean,default:!1},keys:{type:Array,default(){return[]}},record:{type:Object,default(){return{}}},dataFields:{type:Array,default(){return[]}},title:{type:String,default:"View"},inputLabel:{type:Function,default(l){return l}},inputValue:{type:Function,default(l,n){return n[l]}},includeKeys:{type:Array,default(){return[]}}},emits:["update:modelValue"],setup(l,{emit:n}){const b=l,{tagsFields:P,tagsField:z}=Qe(b.dataFields),{formatTag:w,tagStyle:L}=_e(),H=Xe().getSystemConfigs(),{isEmpty:S,notEmpty:D}=et(),g=v({get:()=>b.modelValue,set:F=>{n("update:modelValue",F)}});function se(){n("update:modelValue",!1)}const O=r();async function re(F,y,d){const W=y.map(B=>new Promise((T,p)=>{w(F,B,d,H.tagFormat).then(X=>{T(X)}).catch(X=>{p(X)})}));return new Promise((B,T)=>{Promise.all(W).then(p=>{B({key:d,formattedValue:p})}).catch(p=>{T(p)})})}function ue(F,y,d){return O.value[y]?O.value[y][d]:F[y][d]}return Ye(async()=>{const F=P.value.map(y=>{const d=b.record[y];return re(b.record,d,y)});Promise.all(F).then(y=>{O.value=Object.assign({},b.record),y.forEach(d=>{O.value[d.key]=d.formattedValue})}).catch(y=>{console.error(y)})}),(F,y)=>O.value?(u(),I(o(Ae),{key:0,modelValue:o(g),"onUpdate:modelValue":y[1]||(y[1]=d=>Se(g)?g.value=d:null),title:l.title},{body:M(()=>[x("div",ta,[(u(!0),f(G,null,oe(l.keys,(d,W)=>(u(),f("div",{key:W,class:"data-col"},[x("div",aa,j(l.inputLabel(d)),1),o(z)(d)?m("",!0):(u(),f("div",la,[o(D)(l.record[d])?(u(),f("div",na,j(l.inputValue(d,l.record,l.includeKeys,l.dataFields,o(H))),1)):m("",!0),o(S)(l.record[d])?(u(),f("div",oa," --- no value --- ")):m("",!0)])),o(z)(d)?(u(),f("div",sa,[(u(!0),f(G,null,oe(l.record[d],(B,T)=>(u(),f("div",{key:T,class:"tag",style:Ze(o(L)(l.record,B,d))},j(ue(l.record,d,T)),5))),128)),l.record[d].length===0?(u(),f("div",ra," --- no value --- ")):m("",!0)])):m("",!0)]))),128))])]),actions:M(()=>[U(o(Oe),{"button-type":"text",value:"Close",icon:"fa-solid fa-xmark",onClick:y[0]||(y[0]=d=>se())})]),_:1},8,["modelValue","title"])):m("",!0)}},ia=We(ua,[["__scopeId","data-v-f189e00c"]]);const he=l=>(Zt("data-v-a55972fb"),l=l(),_t(),l),ca={class:"page-container"},da={class:"heading"},fa=he(()=>x("h3",{class:"heading"}," Filters ",-1)),va=["onClick"],ma=he(()=>x("i",{class:"fa-solid fa-sort"},null,-1)),ya=he(()=>x("i",{class:"fa-solid fa-sort-up"},null,-1)),ga=he(()=>x("i",{class:"fa-solid fa-sort-down"},null,-1)),pa={key:0,class:"col"},ha={key:0},Da={key:0},ba={key:1,class:"no-value"},ka={key:1},wa={key:0,class:"no-value"},Fa=["download","href"],Va={__name:"DataPage",props:{dataType:{type:String,default:""},modelClass:{type:String,default:null},filters:{type:Object,default(){return{}}},dataFields:{type:Array,default(){return[]}},fieldsLayout:{type:Array,default(){return[]}},validations:{type:Object,default(){return{}}},fullscreen:{type:Boolean,default:!1},createDialogTitle:{type:Function,default:function(l){return`Create ${l}`}},viewDialogTitle:{type:Function,default:function(l,n){return`View ${l} ${n.id}`}},updateDialogTitle:{type:Function,default:function(l,n){return n?`Update ${l} ${n.id}`:""}},deleteDialogTitle:{type:Function,default:function(l,n){return n?`Delete ${l} ${n.id}`:""}},deleteDialogPrimaryText:{type:Function,default:function(l,n){return n?`Are you sure you want to delete ${l} ${n.id}?`:""}},deleteDialogSecondaryText:{type:Function,default:function(l,n){return n?JSON.stringify(n,!1,2):""}},actions:{type:Object,default(){return{}}}},setup(l){const n=l,{multipartData:b,listableFields:P,viewableKeys:z,creatableKeys:w,updatableKeys:L,includeKeys:R,inputLabel:H,inputValue:S,tagsField:D,formatDataForShow:g,formatDataForSave:se,formatErrorsForDisplay:O,formatFilters:re,validateParams:ue,initOptionsData:F}=Qe(n.dataFields),d=Xe().getSystemConfigs(),{formatTag:W,tagStyle:B}=_e(),T=ea(),p=Qt(),{isEmpty:X,notEmpty:at}=et(),{flashMessage:A}=Gt(),lt=Wt(),nt=r({}),K=r(Array.from(n.dataFields)),xe=r(!1),De=r(!1);function ot(t){K.value=K.value.map(e=>{if(e.type==="enum"){const a=t[e.key].enums,s=Object.keys(a).map(i=>({value:i,label:a[i]}));return Object.assign({},e,{options:s})}else return e})}const st=r(n.filters.layout),be=r(!1),q=r({}),Te=r(Array.from(n.dataFields)),rt=r({}),ut=v(()=>({type:"icon",icon:"fa-solid fa-check"})),it=v(()=>({type:"icon",icon:"fa-solid fa-filter-circle-xmark"})),ct=v(()=>n.dataFields.filter(t=>t.filterable).reduce((t,e)=>(t[e.key]=e,t),{})),ke=v(()=>Object.keys(ct.value)),Ee=v(()=>st.value&&xe.value&&De.value),dt=v(()=>n.filters.layout),ft=v(()=>be.value?"filters expanded":"filters collapsed");async function vt(t){Q.value=0,await _()}async function Y(){De.value=!1,q.value=re(Object.assign({},n.filters.initData));const t=ke.value.map(e=>g(e,q.value));Promise.all(t).then(e=>{ke.value.forEach((a,s)=>{q.value[a]=e[s]}),De.value=!0,Q.value=0,_()})}function mt(){be.value=!be.value}function yt(){Te.value=Array.from(K.value).map(t=>{const e=Object.assign({},t);return e.filterable&&(e.type==="date"?e.type="daterange":e.type==="datetime"?e.type="datetimerange":e.type==="number"&&(e.type="numberrange")),e}).filter(t=>t.filterable)}const ie=r("id"),Z=r(!0),gt=v(()=>({field:ie.value,order:Z.value?"asc":"desc"})),pt=v(()=>n.dataFields.filter(t=>t.sortable).reduce((t,e)=>(t[e.key]=e,t),{})),ht=v(()=>Object.keys(pt.value));function we(t){return ht.value.includes(t)}const Dt=v(()=>n.dataFields.reduce((t,e)=>{const a=e.key;return we(a)&&a===ie.value?Z.value?t[a]="header-field sort down":t[a]="header-field sort up":we(a)?t[a]="header-field sort reset":t[a]="header-field nosort",t},{}));async function bt(t){we(t)&&(t===ie.value?Z.value=!Z.value:(ie.value=t,Z.value=!0),Q.value=0,await _())}const kt=v(()=>{const t={name:"Create",icon:"fa-solid fa-circle-plus fa-xl",click:async function(pe){await Et()}},e=n.actions.create||{},a=Object.assign({},t,e),s={name:"Export",icon:"fa-solid fa-file-export",click:async function(pe){await Ht()}},c=n.actions.export||{},i=Object.assign({},s,c),h={name:"Filter",icon:"fa-solid fa-filter",click:async function(){mt()}},k=n.actions.filter||{},C=Object.assign({},h,k),$=[a,i];return Ee.value&&$.unshift(C),$}),wt=v(()=>{const t={name:"View",icon:"fa-solid fa-magnifying-glass",click:async function($,pe){await xt($.id)}},e=n.actions.view||{},a=Object.assign({},t,e),s={name:"Update",icon:"fa-solid fa-pen-to-square",click:async function($,pe){await Rt($.id)}},c=n.actions.update||{},i=Object.assign({},s,c),h={name:"Delete",icon:"fa-solid fa-trash-can",click:async function($,pe){await Mt($.id)}},k=n.actions.remove||{},C=Object.assign({},h,k);return[a,i,C]}),$e=r([]),je=r(0),Q=r(0),Ue=r(5),ce=r(!1),de=r([]);async function Ft(t){Q.value=t,await _()}async function Vt(t,e,a,s){const c=e.map(i=>new Promise((h,k)=>{W(t,i,a,d.tagFormat).then(C=>{h(C)}).catch(C=>{k(C)})}));return new Promise((i,h)=>{Promise.all(c).then(k=>{i({i:s,key:a,formattedValue:k})}).catch(k=>{h(k)})})}function Ct(t,e,a){const s=`${e}Formatted`;return t[s]?t[s][a]:t[e]}async function St(){const t=[];de.value=[],$e.value.forEach((e,a)=>{de.value.push(Object.assign({},e)),P.value.forEach(s=>{const c=s.key,i=e[c];D(c)&&t.push(Vt(e,i,c,a))})}),Promise.all(t).then(e=>{e.forEach(a=>{const s=`${a.key}Formatted`;de.value[a.i][s]=a.formattedValue})}).catch(e=>{console.error(e)})}lt.registerListener("loadData",{id:`DataPage-${n.dataType}`,invoke:t=>{t.dataType===n.dataType&&_()}});async function Ot(){await p.schemas(n.modelClass).then(t=>{const e=t.fields;ot(e),yt(),xe.value=!0}).catch(t=>{console.error(t),A("Error loading schemas!")})}async function _(){const t={include:R.value,offset:Q.value,limit:Ue.value,filters:re(q.value),sort:gt.value};ce.value=!0,await p.list(n.modelClass,t).then(e=>{$e.value=e.data,St(),je.value=e.total,ce.value=!1}).catch(e=>{ce.value=!1,console.error(e),A("Error loading data!")})}async function Fe(t,e,a){const s={include:R.value};await p.view(n.modelClass,t,s).then(c=>{e(c)}).catch(c=>{a(c)})}const E=r(!1),V=r(""),At=v(()=>V.value&&V.value.length>0?(V.value.match(/.{1,100}/g)??[]).join(`
`):""),Pe=v(()=>({width:800,height:400})),Ve=r(!1),ee=r();async function xt(t){Fe(t,e=>{ee.value=e,Ve.value=!0},e=>{ee.value=null,E.value=!0,V.value=JSON.stringify(e,!1,4)})}const te=r(!1),ae=r(),fe=r({}),Tt=v(()=>n.validations.create||[]);Ce(te,(t,e)=>{t||(fe.value={})});async function Et(t){ae.value={};const e=w.value.map(a=>g(a,{}));Promise.all(e).then(a=>{w.value.forEach((s,c)=>{ae.value[s]=a[c],te.value=!0})})}async function $t(t){const e=jt(t);if(Object.keys(e).length>0){fe.value=e,A("Error creating data!");return}const a=se(t);await p.create(n.modelClass,a,b.value).then(s=>{A("Data created successfully!"),Y(),Ut()}).catch(s=>{fe.value=O(s),A("Error creating data!")})}function jt(t){return ue(Tt.value,t)}function Ut(){te.value=!1,Pt()}function Pt(){ae.value=null}const le=r(!1),N=r(),ve=r({}),Lt=v(()=>n.validations.update||[]);Ce(le,(t,e)=>{t||(ve.value={})});async function Rt(t){Fe(t,e=>{Jt(e),le.value=!0},e=>{Le(),E.value=!0,V.value=JSON.stringify(e,!1,4)})}async function Bt(t){const e=Kt(t);if(Object.keys(e).length>0){ve.value=e,A("Error updating data!");return}const a=t.id,s=se(t);await p.update(n.modelClass,a,s,{},b.value).then(c=>{A("Data updated successfully!"),Y(),Nt()}).catch(c=>{ve.value=O(c),A("Error updating data!")})}function Kt(t){return ue(Lt.value,t)}function Nt(){le.value=!1,Le()}async function Jt(t){N.value={};const e=n.dataFields.map(a=>{const s=a.key;return g(s,t)});Promise.all(e).then(a=>{n.dataFields.forEach((s,c)=>{const i=s.key;N.value[i]=a[c]})})}function Le(){N.value=null}const ne=r(!1),J=r(),It=r({});Ce(ne,(t,e)=>{t||(It.value={})});async function Mt(t){Fe(t,e=>{J.value=e,ne.value=!0},e=>{Be(),E.value=!0,V.value=JSON.stringify(e,!1,4)})}async function zt(){const e=J.value.id;await p.remove(n.modelClass,e).then(a=>{A("Data deleted successfully!"),Y()}).catch(a=>{const s=O(a);V.value=Object.entries(s).map(([c,i])=>i.map(h=>T[h.name](h.params)).join(`
`)).join(`
`),E.value=!0}).finally(()=>{Re()})}function Re(){ne.value=!1,Be()}function Be(){J.value=null}const me=r(!1),ye=r(),ge=r(),Ke=r("downloadAnchor");async function Ht(){await p.download(n.modelClass).then(t=>{const e=window.URL.createObjectURL(new Blob([t.data]));ye.value=e,ge.value=t.filename,me.value=!0}).catch(t=>{E.value=!0,V.value=JSON.stringify(t,!1,4)})}function qt(){Ke.value.click(),Ne()}function Ne(){me.value=!1,ye.value=null,ge.value=null}return Ye(async()=>{await Ot(),await F().then(t=>{nt.value=t}).catch(t=>{E.value=!0,V.value=JSON.stringify(t,!1,4)}),await Y()}),(t,e)=>(u(),f("div",ca,[x("h2",da,j(l.dataType),1),o(Ee)?(u(),f("div",{key:0,class:Je(o(ft))},[fa,U(tt,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),"fields-layout":o(dt),"data-fields":o(ke),schemas:Te.value,"error-messages":rt.value,"confirm-button":o(ut),"cancel-button":o(it),compact:!0,onSubmit:vt,onCancel:Y},null,8,["modelValue","fields-layout","data-fields","schemas","error-messages","confirm-button","cancel-button"])],2)):m("",!0),U(o(Xt),{name:"",headers:o(P),data:de.value,"table-actions":o(kt),actions:o(wt),loading:ce.value,pagination:{offset:Q.value,limit:Ue.value,client:!1},"total-data":je.value,onOffsetChange:Ft},{"header-row":M(({headers:a,actions:s})=>[(u(!0),f(G,null,oe(a,(c,i)=>(u(),f("th",{key:i,class:"col",onClick:h=>bt(c.key)},[x("div",{class:Je(o(Dt)[c.key])},[Ie(j(c.label)+" ",1),ma,ya,ga],2)],8,va))),128)),s.length>0?(u(),f("th",pa)):m("",!0)]),"data-content":M(({headers:a,row:s,i:c})=>[(u(!0),f(G,null,oe(a,(i,h)=>(u(),f("td",{key:h,class:"col"},[Me(t.$slots,`data-col.${i.key}`,ze(He({header:i,row:s,i:c})),()=>[o(D)(i.key)?m("",!0):(u(),f("div",ha,[o(at)(s[i.key])?(u(),f("div",Da,j(o(S)(i.key,s,o(R),K.value,o(d))),1)):m("",!0),o(X)(s[i.key])?(u(),f("div",ba," --- no value --- ")):m("",!0)])),o(D)(i.key)?(u(),f("div",ka,[(u(!0),f(G,null,oe(s[i.key],(k,C)=>(u(),f("div",{key:C,class:"tag",style:Ze(o(B)(s,k,i.key))},j(Ct(s,i.key,C)),5))),128)),s[i.key].length===0?(u(),f("div",wa," --- no value --- ")):m("",!0)])):m("",!0)],!0)]))),128))]),_:3},8,["headers","data","table-actions","actions","loading","pagination","total-data"]),V.value.length>0?(u(),I(o(Ge),{key:1,modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=a=>E.value=a),title:"Error",class:"error-alert",content:o(At),width:o(Pe).width,height:o(Pe).height},null,8,["modelValue","content","width","height"])):m("",!0),ae.value?(u(),I(qe,{key:2,modelValue:te.value,"onUpdate:modelValue":e[2]||(e[2]=a=>te.value=a),schemas:K.value,"fields-layout":l.fieldsLayout,"data-fields":o(w),data:ae.value,"dialog-title":l.createDialogTitle(l.dataType),fullscreen:l.fullscreen,"error-messages":fe.value,onSubmit:$t},null,8,["modelValue","schemas","fields-layout","data-fields","data","dialog-title","fullscreen","error-messages"])):m("",!0),Me(t.$slots,"updateDialog",ze(He({row:N.value})),()=>[N.value?(u(),I(qe,{key:0,modelValue:le.value,"onUpdate:modelValue":e[3]||(e[3]=a=>le.value=a),schemas:K.value,"fields-layout":l.fieldsLayout,"data-fields":o(L),data:N.value,"dialog-title":l.updateDialogTitle(l.dataType,N.value),fullscreen:l.fullscreen,"error-messages":ve.value,onSubmit:Bt},null,8,["modelValue","schemas","fields-layout","data-fields","data","dialog-title","fullscreen","error-messages"])):m("",!0)],!0),ee.value?(u(),I(ia,{key:3,modelValue:Ve.value,"onUpdate:modelValue":e[4]||(e[4]=a=>Ve.value=a),keys:o(z),"include-keys":o(R),"data-fields":K.value,record:ee.value,title:l.viewDialogTitle(l.dataType,ee.value),"input-label":o(H),"input-value":o(S),class:"view-dialog"},null,8,["modelValue","keys","include-keys","data-fields","record","title","input-label","input-value"])):m("",!0),J.value?(u(),I(o(Yt),{key:4,modelValue:ne.value,"onUpdate:modelValue":e[5]||(e[5]=a=>ne.value=a),title:l.deleteDialogTitle(l.dataType,J.value),"primary-text":l.deleteDialogPrimaryText(l.dataType,J.value),"secondary-text":l.deleteDialogSecondaryText(l.dataType,J.value),width:500,height:350,class:"delete-dialog",onConfirm:zt,onCancel:Re},null,8,["modelValue","title","primary-text","secondary-text"])):m("",!0),ye.value?(u(),I(o(Ae),{key:5,modelValue:me.value,"onUpdate:modelValue":e[8]||(e[8]=a=>me.value=a),title:"Download export file",width:400,height:250},{body:M(()=>[Ie(j(ge.value),1)]),actions:M(()=>[x("a",{ref_key:"downloadAnchor",ref:Ke,class:"hidden",rel:"noreferrer",download:ge.value,href:ye.value},null,8,Fa),U(o(Oe),{"button-type":"text",value:"Download",icon:"fa-solid fa-file-arrow-down",onClick:e[6]||(e[6]=a=>qt())}),U(o(Oe),{"button-type":"text",value:"Cancel",icon:"fa-solid fa-xmark",onClick:e[7]||(e[7]=a=>Ne())})]),_:1},8,["modelValue"])):m("",!0)]))}},Ta=We(Va,[["__scopeId","data-v-a55972fb"]]);export{Ta as D,qe as _};
