import{a as be,m as ve,c as i,D as ye}from"./index-5d3b5062.js";import{u as ge}from"./validations-9a1af222.js";const S=be(),Oe=ve(),L=Oe.getSystemConfigs(),{formatDate:Fe,formatTimestamp:de}=ye(),{isEmpty:O,notEmpty:p}=ge();function ke(F){const r=i(()=>F.reduce((e,n)=>(e[n.key]=n,e),{})),V=i(()=>Object.values(r.value).filter(e=>e.listable)),q=i(()=>V.value.map(e=>e.key)),w=i(()=>Object.values(r.value).filter(e=>e.viewable)),B=i(()=>w.value.map(e=>e.key)),D=i(()=>Object.values(r.value).filter(e=>e.creatable)),G=i(()=>D.value.map(e=>e.key)),E=i(()=>Object.values(r.value).filter(e=>e.updatable)),Q=i(()=>E.value.map(e=>e.key)),R=i(()=>Object.values(r.value).some(e=>e.type==="file")),C=i(()=>Object.keys(r.value).filter(e=>x(e))),d=i(()=>Object.keys(r.value).filter(e=>A(e))),U=i(()=>Object.keys(r.value).filter(e=>j(e))),P=i(()=>Object.keys(r.value).filter(e=>v(e))),K=i(()=>Object.keys(r.value).filter(e=>g(e))),W=i(()=>Object.keys(r.value).filter(e=>M(e))),X=i(()=>Object.keys(r.value).filter(e=>z(e))),T=i(()=>Object.keys(r.value).filter(e=>h(e))),I=i(()=>Object.keys(r.value).filter(e=>J(e))),Y=i(()=>Object.keys(r.value).filter(e=>y(e))),Z=i(()=>F.filter(e=>e.reference||e.file)),_=i(()=>Z.value.map(e=>e.key));function o(e){return(r.value[e]||{}).type}function $(e){return(r.value[e]||{}).label}function ee(e,n,t,a){const s=t.find(u=>u===e),c=n[e];if(!O(c))if(p(s)&&!y(e)){const u=n.includes||{},m=[c].flat().filter(f=>!!f).map(f=>{const b=u[e][f];return r.value[e].reference.label(b)});return v(e)?m:m[0]}else return o(e)==="enum"||o(e)==="select"?a.find(m=>m.key===e).options.find(m=>m.value===c).label:o(e)==="datetime"?de(c,L.timezone):o(e)==="date"?Fe(c,L.timezone):y(e)?((n.includes||{})[e][c]||{}).rawData:c}function te(e){return o(e)==="text"||o(e)==="number"}function ne(e){return o(e)==="textarea"}function v(e){return o(e)==="multiSelect"}function g(e){return o(e)==="singleSelect"}function x(e){return o(e)==="select"||o(e)==="enum"}function j(e){return o(e)==="select"||o(e)==="multiSelect"||o(e)==="singleSelect"||o(e)==="enum"}function A(e){return j(e)&&r.value[e].options&&r.value[e].options.server}function M(e){return r.value[e].nullToggleable}function z(e){return e==="tags"||Object.is(r.value[e].isTags,!0)}function h(e){return o(e)==="object"}function J(e){return o(e)==="number"}function y(e){return o(e)==="file"}function N(e,n,t,a){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},a)}function ae(e){return F.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,a=Object.keys(t).map(c=>({value:c,label:t[c]}));return Object.assign({},n,{options:a})}else return n})}function se(e,n){return Object.keys(e).reduce((t,a)=>{const c=e[a].map(u=>u(n)).filter(u=>!!u);return c.length>0&&(t[a]=c),t},{})}async function ue(e,n){return S.view(e,n,{})}async function re(e,n){const t=r.value[e].options,a=t.modelClass,s=n.map(c=>ue(a,c));return new Promise((c,u)=>{Promise.all(s).then(l=>{const m=l.map(f=>{const b=t.value(f),k=t.label(f);return{value:b,label:k}});c(m)}).catch(l=>{console.error(l),u(l)})})}function le(e,n){const t=n[e];if(p(t))return t;const a=r.value[e].defaultValue;return p(a)?a():t}async function ce(e,n){return new Promise((t,a)=>{const s=le(e,n);if(O(s)){t(s);return}if(h(e)){p(s)?t(JSON.stringify(s,!1,4)):t(s);return}if(y(e)){const u=r.value[e].file;if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const l=n.includes[e][s];t(u.label(l))}else S.view(u.modelClass,s,{}).then(l=>{O(n.includes[e])&&(n.includes[e]={}),n.includes[e][s]=l,t(u.label(l))}).catch(l=>{console.error(l),t(s)});return}if(o(e)!=="date"&&o(e)!=="datetime"&&!v(e)&&!g(e)){t(s);return}if(o(e)==="date"||o(e)==="datetime"){let u;s instanceof Date||typeof s=="string"?u=new Date(s):u=Object.entries(s).reduce((l,[m,f])=>(p(f)?l[m]=new Date(f):l[m]=f,l),{}),t(u);return}const c=[s].flat();if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const u=n.includes[e],l=c.map(m=>{const f=u[m],b=r.value[e].options,k=b.value(f),pe=b.label(f);return{value:k,label:pe}});t(l)}else re(e,c).then(u=>{t(u)}).catch(u=>{console.error(u);const l=[];c.forEach(m=>{p(m)&&l.push({value:m,label:m})}),t(l)})})}function oe(e){const n=Object.assign({},e);return P.value.forEach(t=>{const a=n[t]||[];n[t]=a.map(s=>s.value)}),K.value.forEach(t=>{const a=n[t]||[];n[t]=(a[0]||{}).value}),C.value.forEach(t=>{const a=n[t];(O(a)||a.length===0)&&delete n[t]}),T.value.forEach(t=>{p(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),I.value.forEach(t=>{p(n[t])&&(n[t]=parseFloat(n[t]))}),n}function ie(e){return Object.entries(e).reduce((n,[t,a])=>(n[t]=a.map(s=>({name:s,params:{}})),n),{})}function me(e={}){return Object.entries(e).reduce((n,[t,a])=>(p(a)&&a!==""&&(g(t)?n[t]=a[0].value:v(t)?n[t]=a.map(s=>s.value):n[t]=a),n),{})}async function H(e,n){const t=r.value[e].options||{};if(t.server){const a=t.limit||5;return new Promise((s,c)=>{S.list(t.modelClass,{offset:n,limit:a}).then(u=>{const l=u.data,f={total:u.total,data:l.map(b=>({value:t.value(b),label:t.label(b)}))};s(N(e,n,a,f))})})}else return new Promise((a,s)=>{a(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function fe(){return new Promise((e,n)=>{Promise.all(d.value.map(t=>{const a=r.value[t].offset||0;return H(t,a)})).then(t=>{const a={};t.forEach((s,c)=>{const u=d.value[c];a[u]=s}),e(a)}).catch(t=>{n(t)})})}return{schemasMap:r,listableFields:V,listableKeys:q,viewableFields:w,viewableKeys:B,creatableFields:D,creatableKeys:G,updatableFields:E,updatableKeys:Q,multipartData:R,clientOptionsFields:C,clientOptionsField:x,serverOptionsFields:d,serverOptionsField:A,selectableKeys:U,multiSelectableFields:P,singleSelectableFields:K,inputType:o,inputLabel:$,inputValue:ee,inputableField:te,multiInputableField:ne,multiSelectableField:v,singleSelectableField:g,selectableField:j,nullToggleableField:M,nullToggleableFields:W,tagsField:z,tagsFields:X,objectField:h,objectFields:T,numberField:J,numberFields:I,fileField:y,fileFields:Y,includeKeys:_,formatInputOptionsData:N,formatDataFields:ae,formatDataForShow:ce,formatDataForSave:oe,formatErrorsForDisplay:ie,formatFilters:me,validateParams:se,fetchOptions:H,initOptionsData:fe}}export{ke as u};
