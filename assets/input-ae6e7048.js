import{a as be,c as o,C as ve,a1 as ye}from"./index-522b32ec.js";import{u as Oe}from"./validations-9a1af222.js";const w=be(),{formatDate:Fe,formatTimestamp:de}=ve(),{isEmpty:d,notEmpty:p}=Oe(),{base64ToFile:L}=ye();function he(g){const l=o(()=>g.reduce((e,n)=>(e[n.key]=n,e),{})),D=o(()=>Object.values(l.value).filter(e=>e.listable)),U=o(()=>D.value.map(e=>e.key)),V=o(()=>Object.values(l.value).filter(e=>e.viewable)),q=o(()=>V.value.map(e=>e.key)),S=o(()=>Object.values(l.value).filter(e=>e.creatable)),B=o(()=>S.value.map(e=>e.key)),E=o(()=>Object.values(l.value).filter(e=>e.updatable)),G=o(()=>E.value.map(e=>e.key)),Q=o(()=>Object.values(l.value).some(e=>e.type==="file")),T=o(()=>Object.keys(l.value).filter(e=>x(e))),j=o(()=>Object.keys(l.value).filter(e=>A(e))),R=o(()=>Object.keys(l.value).filter(e=>h(e))),P=o(()=>Object.keys(l.value).filter(e=>v(e))),K=o(()=>Object.keys(l.value).filter(e=>F(e))),W=o(()=>Object.keys(l.value).filter(e=>M(e))),X=o(()=>Object.keys(l.value).filter(e=>z(e))),I=o(()=>Object.keys(l.value).filter(e=>k(e))),C=o(()=>Object.keys(l.value).filter(e=>J(e))),Y=o(()=>Object.keys(l.value).filter(e=>y(e))),Z=o(()=>g.filter(e=>e.reference||e.file)),_=o(()=>Z.value.map(e=>e.key));function c(e){return(l.value[e]||{}).type}function $(e){return(l.value[e]||{}).label}function ee(e,n,t,a,s){const m=t.find(u=>u===e),r=n[e];if(!d(r))if(p(m)&&!y(e)){const u=n.includes||{},f=[r].flat().filter(b=>!!b).map(b=>{const O=u[e][b];return l.value[e].reference.label(O)});return v(e)?f:f[0]}else return c(e)==="enum"||c(e)==="select"?a.find(f=>f.key===e).options.find(f=>f.value===r).label:c(e)==="datetime"?de(r,s.timezone):c(e)==="date"?Fe(r,s.timezone):y(e)?((n.includes||{})[e][r]||{}).rawData:r}function te(e){return c(e)==="text"||c(e)==="number"}function ne(e){return c(e)==="textarea"}function v(e){return c(e)==="multiSelect"}function F(e){return c(e)==="singleSelect"}function x(e){return c(e)==="select"||c(e)==="enum"}function h(e){return c(e)==="select"||c(e)==="multiSelect"||c(e)==="singleSelect"||c(e)==="enum"}function A(e){return h(e)&&l.value[e].options&&l.value[e].options.server}function M(e){return l.value[e].nullToggleable}function z(e){return e==="tags"||Object.is(l.value[e].isTags,!0)}function k(e){return c(e)==="object"}function J(e){return c(e)==="number"}function y(e){return c(e)==="file"}function N(e,n,t,a){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},a)}function ae(e){return g.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,a=Object.keys(t).map(m=>({value:m,label:t[m]}));return Object.assign({},n,{options:a})}else return n})}function se(e,n){return Object.keys(e).reduce((t,a)=>{const m=e[a].map(r=>r(n)).filter(r=>!!r);return m.length>0&&(t[a]=m),t},{})}async function ue(e,n){return w.view(e,n,{})}async function re(e,n){const t=l.value[e].options,a=t.modelClass,s=n.map(m=>ue(a,m));return new Promise((m,r)=>{Promise.all(s).then(u=>{const i=u.map(f=>{const b=t.value(f),O=t.label(f);return{value:b,label:O}});m(i)}).catch(u=>{console.error(u),r(u)})})}function le(e,n){const t=n[e];if(p(t))return t;const a=l.value[e].defaultValue;return p(a)?a():t}async function ce(e,n){return new Promise((t,a)=>{const s=le(e,n);if(d(s)){t(s);return}if(k(e)){p(s)?t(JSON.stringify(s,!1,4)):t(s);return}if(y(e)){const r=l.value[e].file;if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const u=n.includes[e][s];L(u.rawData,u.filename,u.mimeType).then(i=>{t(i)}).catch(i=>{a(i)})}else w.view(r.modelClass,s,{}).then(u=>{d(n.includes[e])&&(n.includes[e]={}),n.includes[e][s]=u,L(u.rawData,u.filename,u.mimeType).then(i=>{t(i)}).catch(i=>{a(i)})}).catch(u=>{console.error(u),t(s)});return}if(c(e)!=="date"&&c(e)!=="datetime"&&!v(e)&&!F(e)){t(s);return}if(c(e)==="date"||c(e)==="datetime"){let r;s instanceof Date||typeof s=="string"?r=new Date(s):r=Object.entries(s).reduce((u,[i,f])=>(p(f)?u[i]=new Date(f):u[i]=f,u),{}),t(r);return}const m=[s].flat();if(p(n.includes)&&p(n.includes[e])&&Object.keys(n.includes[e]).length>0){const r=n.includes[e],u=m.map(i=>{const f=r[i],b=l.value[e].options,O=b.value(f),pe=b.label(f);return{value:O,label:pe}});t(u)}else re(e,m).then(r=>{t(r)}).catch(r=>{console.error(r);const u=[];m.forEach(i=>{p(i)&&u.push({value:i,label:i})}),t(u)})})}function ie(e){const n=Object.assign({},e);return P.value.forEach(t=>{const a=n[t]||[];n[t]=a.map(s=>s.value)}),K.value.forEach(t=>{const a=n[t]||[];n[t]=(a[0]||{}).value}),T.value.forEach(t=>{const a=n[t];(d(a)||a.length===0)&&delete n[t]}),I.value.forEach(t=>{p(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),C.value.forEach(t=>{p(n[t])&&(n[t]=parseFloat(n[t]))}),Object.entries(n).reduce((t,[a,s])=>(p(s)&&(t[a]=s),t),{})}function oe(e){return Object.entries(e).reduce((n,[t,a])=>(n[t]=a.map(s=>({name:s,params:{}})),n),{})}function me(e={}){return Object.entries(e).reduce((n,[t,a])=>(p(a)&&a!==""&&(F(t)?n[t]=a[0].value:v(t)?n[t]=a.map(s=>s.value):n[t]=a),n),{})}async function H(e,n){const t=l.value[e].options||{};if(t.server){const a=t.limit||5;return new Promise((s,m)=>{w.list(t.modelClass,{offset:n,limit:a}).then(r=>{const u=r.data,f={total:r.total,data:u.map(b=>({value:t.value(b),label:t.label(b)}))};s(N(e,n,a,f))})})}else return new Promise((a,s)=>{a(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function fe(){return new Promise((e,n)=>{Promise.all(j.value.map(t=>{const a=l.value[t].offset||0;return H(t,a)})).then(t=>{const a={};t.forEach((s,m)=>{const r=j.value[m];a[r]=s}),e(a)}).catch(t=>{n(t)})})}return{schemasMap:l,listableFields:D,listableKeys:U,viewableFields:V,viewableKeys:q,creatableFields:S,creatableKeys:B,updatableFields:E,updatableKeys:G,multipartData:Q,clientOptionsFields:T,clientOptionsField:x,serverOptionsFields:j,serverOptionsField:A,selectableKeys:R,multiSelectableFields:P,singleSelectableFields:K,inputType:c,inputLabel:$,inputValue:ee,inputableField:te,multiInputableField:ne,multiSelectableField:v,singleSelectableField:F,selectableField:h,nullToggleableField:M,nullToggleableFields:W,tagsField:z,tagsFields:X,objectField:k,objectFields:I,numberField:J,numberFields:C,fileField:y,fileFields:Y,includeKeys:_,formatInputOptionsData:N,formatDataFields:ae,formatDataForShow:ce,formatDataForSave:ie,formatErrorsForDisplay:oe,formatFilters:me,validateParams:se,fetchOptions:H,initOptionsData:fe}}export{he as u};
