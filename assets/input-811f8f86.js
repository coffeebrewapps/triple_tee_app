import{a as ye,v as Oe,b as c,A as Fe,a5 as de}from"./index-b3ed4318.js";const w=ye(),{formatDate:ge,formatTimestamp:je}=Fe(),{isEmpty:d,notEmpty:b}=Oe(),{base64ToFile:U}=de();function ke(g){const r=c(()=>g.reduce((e,n)=>(e[n.key]=n,e),{})),D=c(()=>Object.values(r.value).filter(e=>e.listable)),q=c(()=>D.value.map(e=>e.key)),V=c(()=>Object.values(r.value).filter(e=>e.viewable)),B=c(()=>V.value.map(e=>e.key)),S=c(()=>Object.values(r.value).filter(e=>e.creatable)),G=c(()=>S.value.map(e=>e.key)),E=c(()=>Object.values(r.value).filter(e=>e.updatable)),Q=c(()=>E.value.map(e=>e.key)),T=c(()=>Object.values(r.value).filter(e=>e.sortable)),R=c(()=>T.value.map(e=>e.key)),W=c(()=>Object.values(r.value).some(e=>e.type==="file")),P=c(()=>Object.keys(r.value).filter(e=>C(e))),j=c(()=>Object.keys(r.value).filter(e=>M(e))),X=c(()=>Object.keys(r.value).filter(e=>h(e))),K=c(()=>Object.keys(r.value).filter(e=>v(e))),I=c(()=>Object.keys(r.value).filter(e=>F(e))),Y=c(()=>Object.keys(r.value).filter(e=>z(e))),Z=c(()=>Object.keys(r.value).filter(e=>J(e))),A=c(()=>Object.keys(r.value).filter(e=>k(e))),x=c(()=>Object.keys(r.value).filter(e=>N(e))),_=c(()=>Object.keys(r.value).filter(e=>y(e))),$=c(()=>g.filter(e=>e.reference||e.file)),ee=c(()=>$.value.map(e=>e.key));function o(e){return(r.value[e]||{}).type}function te(e){return(r.value[e]||{}).label}function ne(e,n,t,a,s){const m=t.find(u=>u===e),l=n[e];if(!d(l))if(b(m)&&!y(e)){const u=n.includes||{},f=[l].flat().filter(p=>!!p).map(p=>{const O=u[e][p];return r.value[e].reference.label(O)});return v(e)?f:f[0]}else return o(e)==="enum"||o(e)==="select"?a.find(f=>f.key===e).options.find(f=>f.value===l).label:o(e)==="datetime"?je(l,s.timezone):o(e)==="date"?ge(l,s.timezone):y(e)?((n.includes||{})[e][l]||{}).rawData:l}function ae(e){return o(e)==="text"||o(e)==="number"}function se(e){return o(e)==="textarea"}function v(e){return o(e)==="multiSelect"}function F(e){return o(e)==="singleSelect"}function C(e){return o(e)==="select"||o(e)==="enum"}function h(e){return o(e)==="select"||o(e)==="multiSelect"||o(e)==="singleSelect"||o(e)==="enum"}function M(e){return h(e)&&r.value[e].options&&r.value[e].options.server}function z(e){return r.value[e].nullToggleable}function J(e){return e==="tags"||Object.is(r.value[e].isTags,!0)}function k(e){return o(e)==="object"}function N(e){return o(e)==="number"}function y(e){return o(e)==="file"}function H(e,n,t,a){return Object.assign({},{loading:!1,pagination:{offset:n,limit:t,client:!1}},a)}function ue(e){return g.map(n=>{if(n.type==="enum"){const t=e[n.key].enums,a=Object.keys(t).map(m=>({value:m,label:t[m]}));return Object.assign({},n,{options:a})}else return n})}function re(e,n){return Object.keys(e).reduce((t,a)=>{const m=e[a].map(l=>l(n)).filter(l=>!!l);return m.length>0&&(t[a]=m),t},{})}async function le(e,n){return w.view(e,n,{})}async function ce(e,n){const t=r.value[e].options,a=t.modelClass,s=n.map(m=>le(a,m));return new Promise((m,l)=>{Promise.all(s).then(u=>{const i=u.map(f=>{const p=t.value(f),O=t.label(f);return{value:p,label:O}});m(i)}).catch(u=>{console.error(u),l(u)})})}function oe(e,n){const t=n[e];if(b(t))return t;const a=r.value[e].defaultValue;return b(a)?a():t}async function ie(e,n){return new Promise((t,a)=>{const s=oe(e,n);if(d(s)){t(s);return}if(k(e)){b(s)?t(JSON.stringify(s,!1,4)):t(s);return}if(y(e)){const l=r.value[e].file;if(b(n.includes)&&b(n.includes[e])&&Object.keys(n.includes[e]).length>0){const u=n.includes[e][s];U(u.rawData,u.filename,u.mimeType).then(i=>{t(i)}).catch(i=>{a(i)})}else w.view(l.modelClass,s,{}).then(u=>{d(n.includes[e])&&(n.includes[e]={}),n.includes[e][s]=u,U(u.rawData,u.filename,u.mimeType).then(i=>{t(i)}).catch(i=>{a(i)})}).catch(u=>{console.error(u),t(s)});return}if(o(e)!=="date"&&o(e)!=="datetime"&&!v(e)&&!F(e)){t(s);return}if(o(e)==="date"||o(e)==="datetime"){let l;s instanceof Date||typeof s=="string"?l=new Date(s):l=Object.entries(s).reduce((u,[i,f])=>(b(f)?u[i]=new Date(f):u[i]=f,u),{}),t(l);return}const m=[s].flat();if(b(n.includes)&&b(n.includes[e])&&Object.keys(n.includes[e]).length>0){const l=n.includes[e],u=m.map(i=>{const f=l[i],p=r.value[e].options,O=p.value(f),ve=p.label(f);return{value:O,label:ve}});t(u)}else ce(e,m).then(l=>{t(l)}).catch(l=>{console.error(l);const u=[];m.forEach(i=>{b(i)&&u.push({value:i,label:i})}),t(u)})})}function me(e){const n=Object.assign({},e);return K.value.forEach(t=>{const a=n[t]||[];n[t]=a.map(s=>s.value)}),I.value.forEach(t=>{const a=n[t]||[];n[t]=(a[0]||{}).value}),P.value.forEach(t=>{const a=n[t];(d(a)||a.length===0)&&delete n[t]}),A.value.forEach(t=>{b(n[t])&&n[t].length>0&&(n[t]=JSON.parse(n[t]))}),x.value.forEach(t=>{b(n[t])&&(n[t]=parseFloat(n[t]))}),Object.entries(n).reduce((t,[a,s])=>(b(s)&&(t[a]=s),t),{})}function fe(e){return Object.entries(e).reduce((n,[t,a])=>(n[t]=a.map(s=>({name:s,params:{}})),n),{})}function be(e={}){return Object.entries(e).reduce((n,[t,a])=>(b(a)&&a!==""&&(F(t)?n[t]=a[0].value:v(t)?n[t]=a.map(s=>s.value):n[t]=a),n),{})}async function L(e,n){const t=r.value[e].options||{};if(t.server){const a=t.limit||5;return new Promise((s,m)=>{w.list(t.modelClass,{offset:n,limit:a}).then(l=>{const u=l.data,f={total:l.total,data:u.map(p=>({value:t.value(p),label:t.label(p)}))};s(H(e,n,a,f))})})}else return new Promise((a,s)=>{a(Object.assign({},{data:t,total:t.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function pe(){return new Promise((e,n)=>{Promise.all(j.value.map(t=>{const a=r.value[t].offset||0;return L(t,a)})).then(t=>{const a={};t.forEach((s,m)=>{const l=j.value[m];a[l]=s}),e(a)}).catch(t=>{n(t)})})}return{schemasMap:r,listableFields:D,listableKeys:q,viewableFields:V,viewableKeys:B,creatableFields:S,creatableKeys:G,updatableFields:E,updatableKeys:Q,sortableFields:T,sortableKeys:R,multipartData:W,clientOptionsFields:P,clientOptionsField:C,serverOptionsFields:j,serverOptionsField:M,selectableKeys:X,multiSelectableFields:K,singleSelectableFields:I,inputType:o,inputLabel:te,inputValue:ne,inputableField:ae,multiInputableField:se,multiSelectableField:v,singleSelectableField:F,selectableField:h,nullToggleableField:z,nullToggleableFields:Y,tagsField:J,tagsFields:Z,objectField:k,objectFields:A,numberField:N,numberFields:x,fileField:y,fileFields:_,includeKeys:ee,formatInputOptionsData:H,formatDataFields:ue,formatDataForShow:ie,formatDataForSave:me,formatErrorsForDisplay:fe,formatFilters:be,validateParams:re,fetchOptions:L,initOptionsData:pe}}export{ke as u};
