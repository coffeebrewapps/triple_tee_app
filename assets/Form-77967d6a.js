import{b as ve,m as fe,c as O,C as he,_ as Oe,r as ue,o as Ve,d as v,e as z,j as se,F as le,y as ce,J as ke,G as ie,g as S,h as s,B as Fe,f as C,l as Te,W as je,T as De,s as Ce,U as me,V as Ue,Y as Se,$ as pe,k as re,K as we,L as Ee,M as de}from"./index-b3128bd9.js";import{u as Be}from"./errors-a6177d44.js";function Me(){function f(p){return!i(p)}function i(p){return Object.is(p,void 0)||Object.is(p,null)}function F(p,y,o){const d=p[y],M=p[o];if(!(!d||!M)&&d<M)return{name:"earlierThan",params:{compareDate:o}}}function E(p,y){const o=p[y];if(!o)return;if(o>new Date)return{name:"futureDate",params:{}}}function P(p,y){const o=p[y];if(!o)return;if(o<new Date)return{name:"futureDate",params:{}}}function V(p,y,o){const d=p[y];if(!i(d)&&!(d>o))return{name:"greaterThan",params:{compareValue:o}}}function b(p,y,o){const d=p[y];if(!i(d)&&!(d>=o))return{name:"greaterThanOrEqual",params:{compareValue:o}}}function x(p,y,o){const d=p[y];if(!i(d)&&!(d<o))return{name:"lessThan",params:{compareValue:o}}}function I(p,y,o){const d=p[y];if(!i(d)&&!(d<=o))return{name:"lessThanOrEqual",params:{compareValue:o}}}return Object.assign({},{notEmpty:f,isEmpty:i},{notEarlierThan:F,futureDate:E,pastDate:P},{greaterThan:V,greaterThanOrEqual:b,lessThan:x,lessThanOrEqual:I})}const be=ve(),ze=fe(),ge=ze.getSystemConfigs(),{formatDate:Pe,formatTimestamp:xe}=he(),{isEmpty:oe,notEmpty:U}=Me();function Ie(f){const i=O(()=>f.reduce((t,r)=>(t[r.key]=r,t),{})),F=O(()=>Object.keys(i.value).filter(t=>k(t))),E=O(()=>Object.keys(i.value).filter(t=>q(t))),P=O(()=>Object.keys(i.value).filter(t=>A(t))),V=O(()=>Object.keys(i.value).filter(t=>m(t))),b=O(()=>Object.keys(i.value).filter(t=>B(t))),x=O(()=>Object.keys(i.value).filter(t=>J(t))),I=O(()=>Object.keys(i.value).filter(t=>K(t))),_=O(()=>Object.keys(i.value).filter(t=>N(t))),L=O(()=>Object.keys(i.value).filter(t=>R(t))),p=O(()=>f.filter(t=>t.reference)),y=O(()=>p.value.map(t=>t.key));function o(t){return(i.value[t]||{}).type}function d(t){return(i.value[t]||{}).label}function M(t,r,a,n){const u=a.find(e=>e===t),c=r[t];if(!oe(c))if(U(u)){const e=r.includes||{},g=[c].flat().filter(h=>!!h).map(h=>{const w=e[t][h];return i.value[t].reference.label(w)});return m(t)?g:g[0]}else return o(t)==="enum"||o(t)==="select"?n.find(g=>g.key===t).options.find(g=>g.value===c).label:o(t)==="datetime"?xe(c,ge.timezone):o(t)==="date"?Pe(c,ge.timezone):c}function Y(t){return o(t)==="text"||o(t)==="number"}function Q(t){return o(t)==="textarea"}function m(t){return o(t)==="multiSelect"}function B(t){return o(t)==="singleSelect"}function k(t){return o(t)==="select"||o(t)==="enum"}function A(t){return o(t)==="select"||o(t)==="multiSelect"||o(t)==="singleSelect"||o(t)==="enum"}function q(t){return A(t)&&i.value[t].options&&i.value[t].options.server}function J(t){return i.value[t].nullToggleable}function K(t){return t==="tags"||Object.is(i.value[t].isTags,!0)}function N(t){return o(t)==="object"}function R(t){return o(t)==="number"}function H(t,r,a,n){return Object.assign({},{loading:!1,pagination:{offset:r,limit:a,client:!1}},n)}function X(t){return f.map(r=>{if(r.type==="enum"){const a=t[r.key].enums,n=Object.keys(a).map(c=>({value:c,label:a[c]}));return Object.assign({},r,{options:n})}else return r})}function T(t,r){return Object.keys(t).reduce((a,n)=>{const c=t[n].map(e=>e(r)).filter(e=>!!e);return c.length>0&&(a[n]=c),a},{})}async function Z(t,r){return be.view(t,r,{})}async function j(t,r){const a=i.value[t].options,n=a.modelClass,u=r.map(c=>Z(n,c));return new Promise((c,e)=>{Promise.all(u).then(l=>{const g=l.map(h=>{const w=a.value(h),ae=a.label(h);return{value:w,label:ae}});c(g)}).catch(l=>{console.error(l),e(l)})})}function $(t,r){const a=r[t];if(U(a))return a;const n=i.value[t].defaultValue;return U(n)?n():a}async function D(t,r){return new Promise((a,n)=>{const u=$(t,r);if(oe(u)){a(u);return}if(N(t)){U(u)?a(JSON.stringify(u,!1,4)):a(u);return}if(o(t)!=="date"&&o(t)!=="datetime"&&!m(t)&&!B(t)){a(u);return}if(o(t)==="date"||o(t)==="datetime"){let e;u instanceof Date?e=new Date(u):e=Object.entries(u).reduce((l,[g,h])=>(U(h)?l[g]=new Date(h):l[g]=h,l),{}),a(e);return}const c=[u].flat();if(U(r.includes)&&U(r.includes[t])&&Object.keys(r.includes[t]).length>0){const e=r.includes[t],l=c.map(g=>{const h=e[g],w=i.value[t].options,ae=w.value(h),ye=w.label(h);return{value:ae,label:ye}});a(l)}else i.value[t].options,j(t,c).then(e=>{a(e)}).catch(e=>{const l=[];c.forEach(g=>{U(g)&&l.push({value:g,label:g})}),a(l)})})}function ee(t){const r=Object.assign({},t);return V.value.forEach(a=>{const n=r[a]||[];r[a]=n.map(u=>u.value)}),b.value.forEach(a=>{const n=r[a]||[];r[a]=(n[0]||{}).value}),F.value.forEach(a=>{const n=r[a];(oe(n)||n.length===0)&&delete r[a]}),_.value.forEach(a=>{U(r[a])&&r[a].length>0&&(r[a]=JSON.parse(r[a]))}),L.value.forEach(a=>{U(r[a])&&(r[a]=parseFloat(r[a]))}),r}function te(t){return Object.entries(t).reduce((r,[a,n])=>(r[a]=n.map(u=>({name:u,params:{}})),r),{})}function W(t={}){return Object.entries(t).reduce((r,[a,n])=>(U(n)&&(B(a)?r[a]=n[0].value:m(a)?r[a]=n.map(u=>u.value):r[a]=n),r),{})}async function G(t,r){const a=i.value[t].options||{};if(a.server){const n=a.limit||5;return new Promise((u,c)=>{be.list(a.modelClass,{offset:r,limit:n}).then(e=>{const l=e.data,h={total:e.total,data:l.map(w=>({value:a.value(w),label:a.label(w)}))};u(H(t,r,n,h))})})}else return new Promise((n,u)=>{n(Object.assign({},{data:a,total:a.length,loading:!1,pagination:{offset:0,limit:5,client:!0}}))})}async function ne(){return new Promise((t,r)=>{Promise.all(E.value.map(a=>{const n=i.value[a].offset||0;return G(a,n)})).then(a=>{const n={};a.forEach((u,c)=>{const e=E.value[c];n[e]=u}),t(n)}).catch(a=>{r(a)})})}return{schemasMap:i,clientOptionsFields:F,clientOptionsField:k,serverOptionsFields:E,serverOptionsField:q,selectableKeys:P,multiSelectableFields:V,singleSelectableFields:b,inputType:o,inputLabel:d,inputValue:M,inputableField:Y,multiInputableField:Q,multiSelectableField:m,singleSelectableField:B,selectableField:A,nullToggleableField:J,nullToggleableFields:x,tagsField:K,tagsFields:I,objectField:N,objectFields:_,numberField:R,numberFields:L,includeKeys:y,formatInputOptionsData:H,formatDataFields:X,formatDataForShow:D,formatDataForSave:ee,formatErrorsForDisplay:te,formatFilters:W,validateParams:T,fetchOptions:G,initOptionsData:ne}}const _e={class:"body"},Le={class:"data-row"},Ae={class:"field-input"},Ne={key:0,class:"field-toggle"},$e={key:0,class:"actions"},qe={__name:"Form",props:{modelValue:{type:Object,default:{}},fieldsLayout:{type:Array,default:[]},dataFields:{type:Array,default:[]},schemas:{type:Object,default:{}},errorMessages:{type:Object,default(){return{}}},compact:{type:Boolean,default:!1},submittable:{type:Boolean,default:!0},confirmButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-check",value:"Confirm"}}},cancelButton:{type:Object,default(){return{type:"text",icon:"fa-solid fa-xmark",value:"Cancel"}}}},emits:["update:modelValue","submit","cancel"],setup(f,{emit:i}){const F=f,{schemasMap:E,serverOptionsFields:P,inputType:V,inputLabel:b,inputableField:x,multiInputableField:I,multiSelectableField:_,singleSelectableField:L,nullToggleableField:p,nullToggleableFields:y,objectField:o,formatInputOptionsData:d,fetchOptions:M,initOptionsData:Y}=Ie(F.schemas),Q=Be(),m=O({get:()=>F.modelValue,set:n=>{i("update:modelValue",n)}}),B=ue(y.value.reduce((n,u)=>(n[u]=!1,n),{}));function k(n){return!p(n)||B.value[n]}function A(n){return k(n)&&x(n)}function q(n){return k(n)&&(I(n)||o(n))}function J(n){return k(n)&&V(n)==="date"}function K(n){return k(n)&&V(n)==="datetime"}function N(n){return k(n)&&(V(n)==="enum"||V(n)==="select")}function R(n){return k(n)&&V(n)==="daterange"}function H(n){return k(n)&&V(n)==="datetimerange"}function X(n){return k(n)&&V(n)==="boolean"}function T(n){return F.dataFields.find(u=>u===n)}function Z(n){return`Has ${b(n)}`}function j(n){return!F.errorMessages||!F.errorMessages[n]?"":F.errorMessages[n].map(u=>Q[u.name](u.params)).join(", ")}const $=ue({});function D(n){return $.value[n]}function ee(n){return k(n)&&L(n)&&!!D(n)}function te(n){return k(n)&&_(n)&&!!D(n)}const W=O(()=>P.value.reduce((n,u)=>(n[u]=c=>{G(u,c)},n),{}));async function G(n,u){const c=E.value[n].limit||5;await M(n,u).then(e=>{$.value[n]=d(n,u,c,e)})}const ne=O(()=>F.compact?"form compact":"form");function t(n){return p(n)?"data-field toggleable":"data-field"}function r(){i("submit",m.value)}function a(){i("cancel")}return Ve(async()=>{await Y().then(n=>{$.value=n}).catch(n=>{errorAlert.value=!0,errorContent.value=JSON.stringify(n)})}),(n,u)=>(v(),z("div",{class:ie(s(ne))},[se("div",_e,[(v(!0),z(le,null,ce(f.fieldsLayout,c=>(v(),z("div",Le,[(v(!0),z(le,null,ce(Object.keys(c),e=>ke(n.$slots,`form-col.${e}`,we(Ee({field:e,type:s(V)(e),label:s(b)(e)})),()=>[se("div",{class:ie(t(e))},[se("div",Ae,[A(e)?(v(),S(s(Fe),{key:0,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,type:s(V)(e),label:s(b)(e),size:c[e],disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","type","label","size","disabled","error-message"])):C("",!0),q(e)?(v(),S(s(Te),{key:1,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):C("",!0),J(e)?(v(),S(s(je),{key:2,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),disabled:!T(e),"align-pickers":"top","error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):C("",!0),K(e)?(v(),S(s(De),{key:3,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),disabled:!T(e),"display-time":!0,"align-pickers":"top","error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):C("",!0),N(e)?(v(),S(s(Ce),{key:4,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),name:e,id:e,options:s(E)[e].options,size:c[e],disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","name","id","options","size","disabled","error-message"])):C("",!0),ee(e)?(v(),S(s(me),{key:5,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),name:s(b)(e),multiple:!1,options:D(e).data,"options-length":D(e).total,"options-loading":D(e).loading,pagination:D(e).pagination,size:c[e],disabled:!T(e),"error-message":j(e),onOffsetChange:s(W)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):C("",!0),te(e)?(v(),S(s(me),{key:6,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),name:s(b)(e),options:D(e).data,"options-length":D(e).total,"options-loading":D(e).loading,pagination:D(e).pagination,size:c[e],disabled:!T(e),"error-message":j(e),onOffsetChange:s(W)[e]},null,8,["modelValue","onUpdate:modelValue","label","name","options","options-length","options-loading","pagination","size","disabled","error-message","onOffsetChange"])):C("",!0),R(e)?(v(),S(s(Ue),{key:7,"start-date":s(m)[e].startDate,"onUpdate:startDate":l=>s(m)[e].startDate=l,"end-date":s(m)[e].endDate,"onUpdate:endDate":l=>s(m)[e].endDate=l,label:s(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["start-date","onUpdate:startDate","end-date","onUpdate:endDate","label","disabled","error-message"])):C("",!0),H(e)?(v(),S(s(Se),{key:8,"start-time":s(m)[e].startTime,"onUpdate:startTime":l=>s(m)[e].startTime=l,"end-time":s(m)[e].endTime,"onUpdate:endTime":l=>s(m)[e].endTime=l,label:s(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["start-time","onUpdate:startTime","end-time","onUpdate:endTime","label","disabled","error-message"])):C("",!0),X(e)?(v(),S(s(pe),{key:9,modelValue:s(m)[e],"onUpdate:modelValue":l=>s(m)[e]=l,label:s(b)(e),disabled:!T(e),"error-message":j(e)},null,8,["modelValue","onUpdate:modelValue","label","disabled","error-message"])):C("",!0)]),s(p)(e)?(v(),z("div",Ne,[re(s(pe),{modelValue:B.value[e],"onUpdate:modelValue":l=>B.value[e]=l,label:Z(e)},null,8,["modelValue","onUpdate:modelValue","label"])])):C("",!0)],2)],!0)),256))]))),256))]),f.submittable?(v(),z("div",$e,[re(s(de),{class:"button","button-type":f.confirmButton.type,value:f.confirmButton.value,icon:f.confirmButton.icon,onClick:u[0]||(u[0]=c=>r())},null,8,["button-type","value","icon"]),re(s(de),{class:"button","button-type":f.cancelButton.type,value:f.cancelButton.value,icon:f.cancelButton.icon,onClick:u[1]||(u[1]=c=>a())},null,8,["button-type","value","icon"])])):C("",!0)],2))}},Re=Oe(qe,[["__scopeId","data-v-f7df8128"]]);export{Re as F,Me as a,Ie as u};
