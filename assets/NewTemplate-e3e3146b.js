import{_ as W,j as Y,u as q,r as p,c as l,o as $,a as m,b as y,h as C,n as z,t as F,f as s,d as h,i as k,q as L,W as G,e as H,S as J,Y as K}from"./index-499edfe9.js";import{u as P,a as Q}from"./dataAccess-56231f5b.js";import{u as X}from"./errors-a6177d44.js";import{T as Z}from"./TemplateEditor-76cd199c.js";import"./TabContainer-8f807ef8.js";const ee={class:"page-container"},te={class:"heading"},ae={class:"name"},ne={key:1,class:"actions"},se={__name:"NewTemplate",props:{disabled:{type:Boolean,default:!1}},setup(M){const T=Y(),b=P(),d=Q(),S=X(),_=q(),v=p({}),w=Object.assign({},T.currentRoute.value),o=l(()=>{if(a.value)return a.value.id}),f=l({get:()=>a.value.name,set:e=>{a.value.name=e}}),u=l(()=>w.params.templateType),B=l(()=>u.value==="invoice_templates"?"Create Invoice Template":"Create Receipt Template"),E=l(()=>`${b.baseUrl}/api/${u.value}`),a=p({name:null,contentMarkup:null,contentStyles:null}),i=p(!1),c=p({});function V(e){return Object.entries(e).reduce((t,[n,O])=>(t[n]=O.map(I=>({name:I,params:{}})),t),{})}function g(e){return c.value[e]?c.value[e].map(t=>S[t.name](t.params)).join(", "):""}const N=l(()=>{const e={};return c.value.contentMarkup&&(e.contentMarkup=g("contentMarkup")),c.value.contentStyles&&(e.contentStyles=g("contentStyles")),e});async function D(e){if(!o.value){a.value.contentMarkup=e;return}const t=Object.assign({},a.value,{contentMarkup:e});await d.update(u.value,o.value,t).then(n=>{a.value=n,r("Updated markup successfully!")}).catch(n=>{r("Error updating markup!")})}async function R(e){if(!o.value){a.value.contentStyles=e;return}const t=Object.assign({},a.value,{contentStyles:e});await d.update(u.value,o.value,t).then(n=>{a.value=n,r("Updated styles successfully!")}).catch(n=>{r("Error updating styles !")})}function j(e){v.value=e}function x(){i.value=!i.value}function r(e){_.show(e),setTimeout(U,5e3)}function U(){_.hide()}async function A(){const e={name:a.value.name,contentMarkup:a.value.contentMarkup,contentStyles:a.value.contentStyles};await d.create(u.value,e).then(t=>{a.value=t,r("Template created successfully!")}).catch(t=>{r("Error creating template!"),c.value=V(t),console.log(t)})}return $(async()=>{v.value={selfContact:"Coffee Brew Apps",billingContact:"Company ABC",invoiceLines:[{description:"Requirements gathering",unitCost:85,unit:4,subtotal:340}]}}),(e,t)=>(m(),y("div",ee,[C("h2",te,[z(F(s(B))+" ",1),s(o)?h("",!0):(m(),y("i",{key:0,class:"fa-solid fa-circle-exclamation",onClick:x}))]),C("div",ae,[k(s(G),{modelValue:s(f),"onUpdate:modelValue":t[0]||(t[0]=n=>L(f)?f.value=n:null),label:"Template Name",size:"lg","error-message":g("name")},null,8,["modelValue","error-message"])]),a.value?(m(),H(Z,{key:0,"templates-url":s(E),id:a.value.id,"content-markup":a.value.contentMarkup,"content-styles":a.value.contentStyles,data:v.value,disabled:M.disabled,"enable-generate":!1,"error-messages":s(N),onContentMarkupChange:D,onContentStylesChange:R,onDataChange:j},null,8,["templates-url","id","content-markup","content-styles","data","disabled","error-messages"])):h("",!0),s(o)?h("",!0):(m(),y("div",ne,[k(s(J),{value:"Create Template",icon:"fa-solid fa-check",onClick:A})])),k(s(K),{modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=n=>i.value=n),title:"Reminder",content:"You have not saved your template. Make sure to click on Create Template to submit the changes.",width:600,height:250},null,8,["modelValue"])]))}},ie=W(se,[["__scopeId","data-v-737d7ed7"]]);export{ie as default};
