import{c as v,_ as de,a as me,l as pe,u as Te,n as ce,N as We,r as k,w as xe,o as ge,b as i,d as u,i as r,g as a,O as b,y as P,C as Q,e as _,t as V,F as ie,x as ue,j as G,B as he,p as ve,h as fe,v as le}from"./index-4d73f140.js";import{a as we,u as Ee}from"./input-7f33c7c3.js";import{_ as _e,D as $e}from"./DataPage-82c1ede6.js";import{T as Ke}from"./TabContainer-dd359527.js";import"./errors-a6177d44.js";import"./DataForm-7927308b.js";const{isEmpty:Ce,notEarlierThan:Ve}=we();function ke(){const c=[{key:"id",type:"text",label:"ID",listable:!0,viewable:!0,creatable:!1,updatable:!1,sortable:!0},{key:"startTime",type:"datetime",label:"Start Time",defaultValue:()=>new Date,listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"endTime",type:"datetime",label:"End Time",listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,sortable:!0},{key:"description",type:"text",label:"Description",defaultValue:()=>"New Task",listable:!0,viewable:!0,creatable:!0,updatable:!0},{key:"content",type:"textarea",label:"Content",listable:!1,viewable:!0,creatable:!0,updatable:!0},{key:"tags",type:"multiSelect",label:"Tags",reference:{label:p},listable:!0,viewable:!0,creatable:!0,updatable:!0,filterable:!0,options:{server:!0,pagination:!0,modelClass:"tags",value:N,label:p}}],D=[{startTime:"md",endTime:"md"},{description:"lg"},{content:"lg"},{tags:"lg"}],$={initData:{startTime:{startTime:null,endTime:null},endTime:{startTime:null,endTime:null}},layout:[{tags:"md"},{startTime:"md"},{endTime:"md"}]},m={create:{endTime:[K]},update:{endTime:[K]}};function N(n){return n.id}function p(n){return`${n.category}:${n.name}`}function K(n){return Ve(n,"endTime","startTime")}function f(n){if(n===0)return"0 h 0 m 0 s";const L=Math.floor(n/1e3/60/60/24),W=L*1e3*60*60*24,A=Math.floor((n-W)/1e3/60/60),B=A*1e3*60*60,O=Math.floor((n-W-B)/1e3/60),T=O*1e3*60,g=Math.floor((n-W-B-T)/1e3),C=[];return L>0&&C.push(`${L} d`),A>0&&C.push(`${A} h`),O>0&&C.push(`${O} m`),g>0&&C.push(`${g} s`),C.join(" ")}function S(n){return Ce(n.endTime)?new Date-new Date(n.startTime):new Date(n.endTime)-new Date(n.startTime)}const y=v(()=>c.filter(n=>n.reference)),F=v(()=>y.value.map(n=>n.key));return{dataFields:c,fieldsLayout:D,filters:$,validations:m,formatDuration:f,calculateDuration:S,includeKeys:F,recordValue:N,tagLabel:p}}const Ne=c=>(ve("data-v-7cf82650"),c=c(),fe(),c),Fe={class:"today-logs-container"},Me={class:"controls"},Ie=["onKeydown"],Ae=["onKeydown"],Be=["onKeydown"],Oe=["onKeydown"],je=["onKeydown"],He={class:"logs"},Qe={class:"total"},qe=Ne(()=>r("div",{class:"divider"},null,-1)),Ue={class:"duration"},Pe={class:"start-time"},ze={key:0,class:"end-time"},Ge={key:1,class:"elapsed"},Ye={key:2,class:"elapsed"},Je={class:"description"},Re={__name:"TodayLog",setup(c){const{isEmpty:D,notEmpty:$}=we(),m=me();pe();const{formatShortTime:N}=he(),{dataFields:p,fieldsLayout:K,validations:f,formatDuration:S,calculateDuration:y,includeKeys:F}=ke(),{formatDataFields:n,validateParams:L,formatDataForShow:W,formatDataForSave:A}=Ee(p),B=Te(),O=ce(),T=We(),g=k([]),C=v(()=>p.map(e=>e.key)),x=k({}),ae=v(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}),se=v(()=>{const e=new Date;return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e}),q=k([]),U=v(()=>q.value.length===0?!1:D(x.value.endTime)&&j.value),R=v(()=>q.value.reduce((e,l)=>e+l.duration,0));function X(e){return e.map(l=>(l.duration=y(l),l))}function Z(e){return D(e)?{}:(e.duration=y(e),e)}const E=k(!1),j=k(!1);function o(){return p.reduce((e,l)=>{const d=l.key,te=l.defaultValue;return $(te)?e[d]=te():e[d]=null,e},{})}function t(){x.value=o(),z.value="",E.value=!0}async function s(){x.value=o(),z.value="",await I()}function M(){E.value=!1}async function I(){const e=L(f.create,x.value);if(Object.keys(e).length>0){H("Error submitting task!");return}const l=A(x.value);await m.create("work_logs",l).then(d=>{H("Started task successfully!"),ee(),M()}).catch(d=>{console.error(d),H("Error creating data!")})}const h=k(!1),z=k(""),w=k({});xe(h,(e,l)=>{e||(w.value={})});async function be(){const e=L(f.update,w.value);if(Object.keys(e).length>0){H("Error submitting task!");return}const l=A(w.value);await m.update("work_logs",w.value.id,l).then(d=>{H("Ended task successfully!"),ee(),De(),z.value==="quick"?s():z.value==="input"&&setTimeout(t,1e3)}).catch(d=>{console.error(d),H("Error submiting task!")})}async function Y(){w.value=Object.assign({},x.value),await W("startTime",w.value).then(e=>{w.value.startTime=e}),await W("tags",w.value).then(e=>{w.value.tags=e}),w.value.endTime=new Date,h.value=!0}function ne(){Y(),z.value="input"}function oe(){Y(),z.value="quick"}function De(){w.value={},h.value=!1}const re=k(!1),J=v(()=>re.value?"shortcut show":"shortcut hide");T.registerListener({route:"/work_logs",eventType:"ctrl-n"},{id:"TodayStartTask",invoke:e=>{t()}}),T.registerListener({route:"/work_logs",eventType:"ctrl-q"},{id:"TodayQuickStartTask",invoke:e=>{s()}}),T.registerListener({route:"/work_logs",eventType:"ctrl-e"},{id:"TodayEndTask",invoke:e=>{Y()}}),T.registerListener({route:"/work_logs",eventType:"ctrl-g"},{id:"TodayEndTaskAndStartTask",invoke:e=>{ne()}}),T.registerListener({route:"/work_logs",eventType:"ctrl-f"},{id:"TodayEndTaskAndQuickStartTask",invoke:e=>{oe()}}),T.registerListener({route:"/work_logs",eventType:"keydown-Escape"},{id:"CloseTodayLogDialogs",invoke:e=>{E.value&&(E.value=!1),h.value&&(h.value=!1)}});function H(e){B.show(e),setTimeout(Se,5e3)}function Se(){B.hide()}O.registerListener("loadTodayLogs",{id:"TodayLog",invoke:e=>{ee()}}),O.registerListener("toggleShortcut",{id:"ToggleTodayLogShortcut",invoke:e=>{re.value=!re.value}});async function Le(){await m.schemas("work_logs").then(e=>{const l=e.fields;g.value=n(l)}).catch(e=>{H("Error loading schemas!"),console.log(e)})}async function ee(){const e={include:F.value,filters:{startTime:{startDate:ae.value,endDate:se.value}},sort:{field:"startTime",order:"desc"}};await m.list("work_logs",e).then(l=>{q.value=X(l.data),x.value=Z(q.value[0]),$(x.value.startTime)&&(j.value=!0)}).catch(l=>{H("Error loading work logs!"),console.log(l)})}return ge(async()=>{await ee(),await Le()}),(e,l)=>(i(),u("div",Fe,[r("div",Me,[a(U)?_("",!0):(i(),u("div",{key:0,class:"button",tabindex:"0",onClick:t,onKeydown:b(t,["enter"])},[P(" Start New Task "),r("div",{class:Q(a(J))}," N ",2)],40,Ie)),a(U)?_("",!0):(i(),u("div",{key:1,class:"button",tabindex:"0",onClick:s,onKeydown:b(s,["enter"])},[P(" Quick Start New Task "),r("div",{class:Q(a(J))}," Q ",2)],40,Ae)),a(U)?(i(),u("div",{key:2,class:"button",tabindex:"0",onClick:Y,onKeydown:b(Y,["enter"])},[P(" End Current Task "),r("div",{class:Q(a(J))}," E ",2)],40,Be)):_("",!0),a(U)?(i(),u("div",{key:3,class:"button",tabindex:"0",onClick:ne,onKeydown:b(ne,["enter"])},[P(" End and Start New "),r("div",{class:Q(a(J))}," G ",2)],40,Oe)):_("",!0),a(U)?(i(),u("div",{key:4,class:"button",tabindex:"0",onClick:oe,onKeydown:b(oe,["enter"])},[P(" End and Quick Start "),r("div",{class:Q(a(J))}," F ",2)],40,je)):_("",!0)]),r("div",He,[r("div",Qe," Today's total: "+V(a(S)(a(R))),1),(i(!0),u(ie,null,ue(q.value,(d,te)=>(i(),u("div",{key:te,class:"log"},[qe,r("div",Ue,[r("div",Pe,V(a(N)(d.startTime)),1),a($)(d.endTime)?(i(),u("div",ze," to "+V(a(N)(d.endTime)),1)):_("",!0),a($)(d.endTime)?(i(),u("div",Ge," ("+V(a(S)(d.duration))+") ",1)):_("",!0),a(D)(d.endTime)?(i(),u("div",Ye," (not ended) ")):_("",!0)]),r("div",Je,V(d.description),1)]))),128))]),G(_e,{modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=d=>E.value=d),schemas:g.value,"fields-layout":a(K),"data-fields":a(C),data:x.value,fullscreen:!0,"dialog-title":"Start Task",onSubmit:I},null,8,["modelValue","schemas","fields-layout","data-fields","data"]),G(_e,{modelValue:h.value,"onUpdate:modelValue":l[1]||(l[1]=d=>h.value=d),schemas:g.value,"fields-layout":a(K),"data-fields":a(C),data:w.value,fullscreen:!0,"dialog-title":"End Task",onSubmit:be},null,8,["modelValue","schemas","fields-layout","data-fields","data"])]))}},Xe=de(Re,[["__scopeId","data-v-7cf82650"]]);const ye=c=>(ve("data-v-6d859643"),c=c(),fe(),c),Ze={class:"weekly-tab-container"},et={class:"weekly-tabs"},tt=["onKeydown"],at=ye(()=>r("i",{class:"fa-solid fa-angle-left"},null,-1)),st=["onKeydown"],nt=["onKeydown"],ot=ye(()=>r("i",{class:"fa-solid fa-angle-right"},null,-1)),rt={class:"weekly-tab-content"},lt={key:0,class:"total"},it={key:1,class:"total"},ut={class:"timeline"},dt=ye(()=>r("div",{class:"divider"},null,-1)),ct={class:"heading"},vt={class:"date"},ft={key:0,class:"duration"},kt={key:1,class:"duration"},yt={class:"entries"},_t={key:0},mt={class:"description"},pt={class:"duration"},Tt={__name:"WeekLog",props:{loadData:{type:Boolean,default:!1}},setup(c){const D=me();pe();const{formatLongDate:$}=he(),{formatDuration:m,calculateDuration:N}=ke(),p=Te(),K=ce(),f=k("this"),S=k({}),y=k(0),F=k("prevWeekTab"),n=k("thisWeekTab"),L=k("nextWeekTab"),W=v(()=>{const o=new Date,t=new Date,s=y.value*7;return f.value==="prev"?(t.setDate(t.getDate()+s),t.setDate(t.getDate()-o.getDay())):(f.value==="next"&&t.setDate(t.getDate()+s),t.setDate(t.getDate()-o.getDay())),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t}),A=v(()=>{const o=new Date;return o.setDate(W.value.getDate()+6),o.setHours(23),o.setMinutes(59),o.setSeconds(59),o}),B=v(()=>Array.from(Array(7)).map((o,t)=>{const s=new Date(W.value);return s.setDate(W.value.getDate()+t),s.setHours(0),s.setMinutes(0),s.setSeconds(0),s})),O=v(()=>({startTime:{startDate:W.value,endDate:A.value}})),T=v(()=>Object.entries(S.value).reduce((o,[t,{total:s}])=>o+s,0));function g(o){return S.value[o]?S.value[o]:{total:0,entries:[]}}function C(o){const t=B.value.reduce((s,M)=>(s[M]={entries:[],total:0},s),{});return o.forEach(s=>{const M=new Date(s.startTime),I=new Date(M.getFullYear(),M.getMonth(),M.getDate(),0,0,0),h=N(s);t[I].entries.push(Object.assign({},s,{duration:h})),t[I].total=t[I].total+h}),t}function x(o){p.show(o),setTimeout(ae,5e3)}function ae(){p.hide()}K.registerListener("loadWeeklyLogs",{id:"WeekLog",invoke:o=>{j()}});const se=v(()=>f.value==="prev"?"weekly-tab active":"weekly-tab"),q=v(()=>f.value==="this"?"weekly-tab active":"weekly-tab"),U=v(()=>f.value==="next"?"weekly-tab active":"weekly-tab");async function R(){y.value=y.value-1,f.value="prev",F.value.blur(),await j()}async function X(){y.value=0,f.value="this",n.value.blur(),await j()}async function Z(){y.value=y.value+1,f.value="next",L.value.blur(),await j()}function E(o){o==="prev"?F.value.focus():o==="next"?L.value.focus():n.value.focus()}async function j(){const o={filters:O.value};await D.list("work_logs",o).then(t=>{S.value=C(t.data)}).catch(t=>{x("Error loading work logs!"),console.log(t)})}return ge(async()=>{await j()}),(o,t)=>(i(),u("div",Ze,[r("div",et,[r("div",{ref_key:"prevWeekTab",ref:F,class:Q(a(se)),tabindex:"0",onClick:R,onKeydown:[b(R,["enter"]),t[0]||(t[0]=b(s=>E("this"),["arrow-right"]))]},[at,P(" Prev Week ")],42,tt),r("div",{ref_key:"thisWeekTab",ref:n,class:Q(a(q)),tabindex:"0",onClick:X,onKeydown:[b(X,["enter"]),t[1]||(t[1]=b(s=>E("prev"),["arrow-left"])),t[2]||(t[2]=b(s=>E("next"),["arrow-right"]))]}," This Week ",42,st),r("div",{ref_key:"nextWeekTab",ref:L,class:Q(a(U)),tabindex:"0",onClick:Z,onKeydown:[b(Z,["enter"]),t[3]||(t[3]=b(s=>E("this"),["arrow-left"]))]},[P(" Next Week "),ot],42,nt)]),r("div",rt,[a(T)>0?(i(),u("div",lt," Week's total: "+V(a(m)(a(T))),1)):_("",!0),a(T)===0?(i(),u("div",it," Week's total: 0 h 0 m 0 s ")):_("",!0),r("div",ut,[(i(!0),u(ie,null,ue(a(B),(s,M)=>(i(),u("div",{key:M,class:"day"},[dt,r("div",ct,[r("div",vt,V(a($)(s)),1),g(s).total>0?(i(),u("div",ft," ("+V(a(m)(g(s).total))+") ",1)):_("",!0),g(s).total===0?(i(),u("div",kt," (0 h 0 m 0 s) ")):_("",!0)]),r("div",yt,[g(s).entries.length===0?(i(),u("div",_t," No entry ")):_("",!0),(i(!0),u(ie,null,ue(g(s).entries,(I,h)=>(i(),u("div",{key:h,class:"entry"},[r("div",mt,V(I.description),1),r("div",pt,V(a(m)(I.duration)),1)]))),128))])]))),128))])])]))}},gt=de(Tt,[["__scopeId","data-v-6d859643"]]);const ht=c=>(ve("data-v-179a8f48"),c=c(),fe(),c),wt={class:"view-container"},bt=ht(()=>r("h2",{class:"heading"}," Time Tracking ",-1)),Dt={__name:"WorkLogs",setup(c){const D=ce(),{dataFields:$,fieldsLayout:m,filters:N,validations:p}=ke(),K=[{label:"Today",onchange:f},{label:"Weekly",onchange:S},{label:"All Logs",onchange:y}];function f(){D.emitEvent("loadTodayLogs",{})}function S(){D.emitEvent("loadWeeklyLogs",{})}function y(){D.emitEvent("loadData",{dataType:"Work Logs"})}function F(n){K[n].onchange()}return(n,L)=>(i(),u("div",wt,[bt,G(Ke,{tabs:K,onTabChange:F},{"tab-0":le(()=>[G(Xe)]),"tab-1":le(()=>[G(gt)]),"tab-2":le(()=>[G($e,{"model-class":"work_logs","data-type":"Work Logs",fullscreen:!0,"fields-layout":a(m),"data-fields":a($),validations:a(p),filters:a(N)},null,8,["fields-layout","data-fields","validations","filters"])]),_:1})]))}},Kt=de(Dt,[["__scopeId","data-v-179a8f48"]]);export{Kt as default};
